define(["INST","i18n","jquery","jquery.ajaxJSON"],function(a,b,c){b=b.scoped("page_views"),c(document).ready(function(){var b=0,d=c("#page_view_id"),e=c("#page_view_update_path").attr("href"),f=!1;a.interaction_contexts={};if(document.cookie&&document.cookie.match(/last_page_view/)){var g=document.cookie.match(/last_page_view=([^;]+)/);if(g&&g[1])try{var h=c.parseJSON(unescape(g[1]));h&&h.url&&h.seconds&&setTimeout(function(){c.ajaxJSON(h.url,"PUT",{interaction_seconds:h.seconds},function(){},function(){},3e3)})}catch(i){}document.cookie="last_page_view=;expires=Thu, 01-Jan-1970 00:00:01 GMT"}if(d.length>0){var j=0,k=300;c(document).bind("page_view_id_received",function(a,b){c("#page_view_id").text(b),e="/page_views/"+b}),c(document).bind("page_view_update",function(a,f){var g={};d.hasClass("contributed")&&(g.contributed=!0);if(f||b>10&&j<k)g.interaction_seconds=b,c.ajaxJSON(e,"PUT",g,function(a){a&&a.id&&c(document).triggerHandler("page_view_id_receved",a.id)},function(){}),b=0}),setInterval(function(){c(document).triggerHandler("page_view_update")},1e3*k),window.onbeforeunload=function(){if(b>30){var a=new Date;a.setDate(a.getDate()+1);var c=JSON.stringify({url:e,seconds:b});document.cookie="last_page_view="+escape(c)}};var f=!1;c(document).bind("mousemove keypress mousedown focus",function(){f=!0}),setInterval(function(){f?(b++,a&&a.interaction_context&&a.interaction_contexts&&(a.interaction_contexts[a.interaction_context]=(a.interaction_contexts[a.interaction_context]||0)+1),f=!1,j>=k&&(j=0,c(document).triggerHandler("page_view_update")),j=0):j++},1e3)}})})
define(function(){function d(a,b){var c=document.createElement(a||"div"),d;for(d in b)c[d]=b[d];return c}function e(a,b,c){return c&&!c.parentNode&&e(a,c),a.insertBefore(b,c||null),a}function g(c,d,e,g){var h=["opacity",d,~~(c*100),e,g].join("-"),i=.01+e/g*100,j=Math.max(1-(1-c)/d*(100-i),c),k,l;if(!b[h]){for(l=0;l<a.length;l++){k=a[l]&&"-"+a[l].toLowerCase()+"-"||"";try{f.insertRule("@"+k+"keyframes "+h+"{"+"0%{opacity:"+j+"}"+i+"%{opacity:"+c+"}"+(i+.01)+"%{opacity:1}"+(i+d)%100+"%{opacity:"+c+"}"+"100%{opacity:"+j+"}"+"}",0)}catch(m){}}b[h]=1}return h}function h(b,c){var d=b.style,e,f;if(d[c]!==undefined)return c;c=c.charAt(0).toUpperCase()+c.slice(1);for(f=0;f<a.length;f++){e=a[f]+c;if(d[e]!==undefined)return e}}function i(a,b){for(var c in b)a.style[h(a,c)||c]=b[c];return a}function j(a,b){for(var c in b)a[c]===undefined&&(a[c]=b[c]);return a}function k(a){var b={x:a.offsetLeft,y:a.offsetTop};while(a=a.offsetParent)b.x+=a.offsetLeft,b.y+=a.offsetTop;return b}var a=["webkit","Moz","ms","O"],b={},c;e(document.getElementsByTagName("head")[0],d("style"));var f=document.styleSheets[document.styleSheets.length-1],l=function(a){this.opts=j(a||{},{lines:12,length:7,width:5,radius:10,color:"#000",speed:1,trail:100,opacity:.25})},m=l.prototype={spin:function(a){var b=this,f=b.el=i(d(),{position:"absolute"}),g,h;a&&(h=k(e(a,f,a.firstChild)),g=k(f),i(f,{left:(a.offsetWidth>>1)-g.x+h.x+"px",top:(a.offsetHeight>>1)-g.y+h.y+"px"})),b.lines(f,b.opts);if(!c){var j=b.opts,l=0,m=20/j.speed,n=(1-j.opacity)/(m*j.trail/100),o=m/j.lines;(function p(){l++;for(var a=j.lines;a;a--){var c=Math.max(1-(l+a*o)%m*n,j.opacity);b.opacity(f,j.lines-a,c,j)}b.timeout=b.el&&setTimeout(p,50)})()}return b},stop:function(){var a=this,b=a.el;return clearTimeout(a.timeout),b&&b.parentNode&&b.parentNode.removeChild(b),a.el=undefined,a}};return m.lines=function(a,b){function h(a,e){return i(d(),{position:"absolute",width:b.length+b.width+"px",height:b.width+"px",background:a,boxShadow:e,transformOrigin:"left",transform:"rotate("+~~(360/b.lines*c)+"deg) translate("+b.radius+"px"+",0)",borderRadius:"100em"})}var c=0,f;for(;c<b.lines;c++)f=i(d(),{position:"absolute",top:1+~(b.width/2)+"px",transform:"translate3d(0,0,0)",opacity:b.opacity,animation:g(b.opacity,b.trail,c,b.lines)+" "+1/b.speed+"s linear infinite"}),b.shadow&&e(f,i(h("#000","0 0 4px #000"),{top:"2px"})),e(a,e(f,h(b.color,"0 0 1px rgba(0,0,0,.1)")));return a},m.opacity=function(a,b,c){a.childNodes[b].style.opacity=c},function(){var a=i(d("group"),{behavior:"url(#default#VML)"}),b;if(!h(a,"transform")&&a.adj){for(b=4;b--;)f.addRule(["group","roundrect","fill","stroke"][b],"behavior:url(#default#VML)");m.lines=function(a,b){function g(){return i(d("group",{coordsize:f+" "+f,coordorigin:-c+" "+ -c}),{width:f,height:f})}function l(a,f,j){e(h,e(i(g(),{rotation:360/b.lines*a+"deg",left:~~f}),e(i(d("roundrect",{arcsize:1}),{width:c,height:b.width,left:b.radius,top:-b.width>>1,filter:j}),d("fill",{color:b.color,opacity:b.opacity}),d("stroke",{opacity:0}))))}var c=b.length+b.width,f=2*c,h=g(),j=~(b.length+b.radius+b.width)+"px",k;if(b.shadow)for(k=1;k<=b.lines;k++)l(k,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(k=1;k<=b.lines;k++)l(k);return e(i(a,{margin:j+" 0 0 "+j}),h)},m.opacity=function(a,b,c,d){d=d.shadow&&d.lines||0,a.firstChild.childNodes[b+d].firstChild.firstChild.opacity=c}}else c=h(a,"animation")}(),window.Spinner=l,l})
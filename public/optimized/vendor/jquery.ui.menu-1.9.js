define(["jquery","vendor/jquery.ui.core-1.9","vendor/jquery.ui.widget-1.9"],function(a,b,c){var d=0;a.widget("ui.menu",{version:"@VERSION",defaultElement:"<ul>",delay:150,options:{position:{my:"left top",at:"right top"}},_create:function(){var b=this;this.activeMenu=this.element,this.menuId=this.element.attr("id")||"ui-menu-"+d++,this.element.find(".ui-icon").length&&this.element.addClass("ui-menu-icons"),this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({id:this.menuId,role:"menu"}).bind("click.menu",function(c){var d=a(c.target).closest(".ui-menu-item:has(a)");if(b.options.disabled)return!1;if(!d.length)return;(!b.active||b.active[0]!==d[0])&&b.focus(c,d),b.select(c)}).bind("mouseover.menu",function(c){if(b.options.disabled)return;var d=a(c.target).closest(".ui-menu-item");d.length&&(d.siblings().children(".ui-state-active").removeClass("ui-state-active"),b.focus(c,d))}).bind("mouseout.menu",function(c){if(b.options.disabled)return;var d=a(c.target).closest(".ui-menu-item");d.length&&b.blur(c)}).bind("focus.menu",function(c){if(b.options.disabled)return;b.focus(c,a(c.target).children(".ui-menu-item:first"))}).bind("blur.menu",function(a){if(b.options.disabled)return;b.collapseAll(a)}),this.refresh(),this.element.attr("tabIndex",0).bind("keydown.menu",function(c){if(b.options.disabled)return;switch(c.keyCode){case a.ui.keyCode.PAGE_UP:b.previousPage(c),c.preventDefault(),c.stopImmediatePropagation();break;case a.ui.keyCode.PAGE_DOWN:b.nextPage(c),c.preventDefault(),c.stopImmediatePropagation();break;case a.ui.keyCode.HOME:b._move("first","first",c),c.preventDefault(),c.stopImmediatePropagation();break;case a.ui.keyCode.END:b._move("last","last",c),c.preventDefault(),c.stopImmediatePropagation();break;case a.ui.keyCode.UP:b.previous(c),c.preventDefault(),c.stopImmediatePropagation();break;case a.ui.keyCode.DOWN:b.next(c),c.preventDefault(),c.stopImmediatePropagation();break;case a.ui.keyCode.LEFT:b.collapse(c)&&c.stopImmediatePropagation(),c.preventDefault();break;case a.ui.keyCode.RIGHT:b.expand(c)&&c.stopImmediatePropagation(),c.preventDefault();break;case a.ui.keyCode.ENTER:b.active.children("a[aria-haspopup='true']").length?b.expand(c)&&c.stopImmediatePropagation():(b.select(c),c.stopImmediatePropagation()),c.preventDefault();break;case a.ui.keyCode.ESCAPE:b.collapse(c)&&c.stopImmediatePropagation(),c.preventDefault();break;default:c.stopPropagation(),clearTimeout(b.filterTimer);var d,e=b.previousFilter||"",f=String.fromCharCode(c.keyCode),g=!1;f==e?g=!0:f=e+f;function h(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}d=b.activeMenu.children(".ui-menu-item").filter(function(){return(new RegExp("^"+h(f),"i")).test(a(this).children("a").text())}),d=g&&d.index(b.active.next())!=-1?b.active.nextAll(".ui-menu-item"):d,d.length||(f=String.fromCharCode(c.keyCode),d=b.activeMenu.children(".ui-menu-item").filter(function(){return(new RegExp("^"+h(f),"i")).test(a(this).children("a").text())})),d.length?(b.focus(c,d),d.length>1?(b.previousFilter=f,b.filterTimer=setTimeout(function(){delete b.previousFilter},1e3)):delete b.previousFilter):delete b.previousFilter}}),this._bind(document,{click:function(b){a(b.target).closest(".ui-menu").length||this.collapseAll(b)}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find("ul").andSelf().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").show(),this.element.find(".ui-menu-item").unbind(".menu").removeClass("ui-menu-item").removeAttr("role").children("a").removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").removeAttr("id").children(".ui-icon").remove()},refresh:function(){var b=this,c=this.element.find("ul:not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr("role","menu").hide().attr("aria-hidden","true").attr("aria-expanded","false"),d=c.add(this.element).children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation");d.children("a").addClass("ui-corner-all").attr("tabIndex",-1).attr("role","menuitem").attr("id",function(a){return b.element.attr("id")+"-"+a}),c.each(function(){var b=a(this),c=b.prev("a");c.attr("aria-haspopup","true").prepend('<span class="ui-menu-icon ui-icon ui-icon-carat-1-e"></span>'),b.attr("aria-labelledby",c.attr("id"))})},focus:function(b,c){var d,e=this;this.blur(b);if(this._hasScroll()){var f=parseFloat(a.curCSS(this.activeMenu[0],"borderTopWidth",!0))||0,g=parseFloat(a.curCSS(this.activeMenu[0],"paddingTop",!0))||0,h=c.offset().top-this.activeMenu.offset().top-f-g,i=this.activeMenu.scrollTop(),j=this.activeMenu.height(),k=c.height();h<0?this.activeMenu.scrollTop(i+h):h+k>j&&this.activeMenu.scrollTop(i+h-j+k)}this.active=c.first().children("a").addClass("ui-state-focus").end(),e.element.attr("aria-activedescendant",e.active.children("a").attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),e.timer=setTimeout(function(){e._close()},e.delay),d=a(">ul",c),d.length&&/^mouse/.test(b.type)&&e._startOpening(d),this.activeMenu=c.parent(),this._trigger("focus",b,{item:c})},blur:function(a){if(!this.active)return;clearTimeout(this.timer),this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",a,{item:this.active})},_startOpening:function(a){clearTimeout(this.timer);if(a.attr("aria-hidden")!=="true")return;var b=this;b.timer=setTimeout(function(){b._close(),b._open(a)},b.delay)},_open:function(b){clearTimeout(this.timer),this.element.find(".ui-menu").not(b.parents()).hide().attr("aria-hidden","true");var c=a.extend({},{of:this.active},a.type(this.options.position)=="function"?this.options.position(this.active):this.options.position);b.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(c)},collapseAll:function(a){this.element.find("ul").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active"),this.blur(a),this.activeMenu=this.element},_close:function(){this.active.parent().find("ul").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(a){var b=this.active&&this.active.parents("li:not(.ui-menubar-item)").first();if(b&&b.length)return this.active.parent().attr("aria-hidden","true").attr("aria-expanded","false").hide(),this.focus(a,b),!0},expand:function(a){var b=this,c=this.active&&this.active.children("ul").children("li").first();if(c&&c.length)return this._open(c.parent()),setTimeout(function(){b.focus(a,c)},20),!0},next:function(a){this._move("next","first",a)},previous:function(a){this._move("prev","last",a)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(a,b,c){if(!this.active){this.focus(c,this.activeMenu.children(".ui-menu-item")[b]());return}var d;a==="first"||a==="last"?d=this.active[a==="first"?"prevAll":"nextAll"](".ui-menu-item").eq(-1):d=this.active[a+"All"](".ui-menu-item").eq(0),d.length?this.focus(c,d):this.focus(c,this.activeMenu.children(".ui-menu-item")[b]())},nextPage:function(b){if(this._hasScroll()){if(!this.active){this.focus(b,this.activeMenu.children(".ui-menu-item").first());return}if(this.last())return;var c=this.active.offset().top,d=this.element.height(),e;this.active.nextAll(".ui-menu-item").each(function(){return e=a(this),a(this).offset().top-c-d<0}),this.focus(b,e)}else this.focus(b,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]())},previousPage:function(b){if(this._hasScroll()){if(!this.active){this.focus(b,this.activeMenu.children(".ui-menu-item").first());return}if(this.first())return;var c=this.active.offset().top,d=this.element.height(),e;this.active.prevAll(".ui-menu-item").each(function(){return e=a(this),a(this).offset().top-c+d>0}),this.focus(b,e)}else this.focus(b,this.activeMenu.children(".ui-menu-item").first())},_hasScroll:function(){return this.element.height()<this.element.prop("scrollHeight")},select:function(a){var b={item:this.active};this.collapseAll(a),this._trigger("select",a,b)}})})
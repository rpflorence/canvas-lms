Raphael.fn.g.barchart=function(a,b,c,d,e,f){f=f||{};var g={round:"round",sharp:"sharp",soft:"soft"}[f.type]||"square",h=parseFloat(f.gutter||"20%"),i=this.set(),j=this.set(),k=this.set(),l=this.set(),m=Math.max.apply(Math,e),n=[],o=this,p=0,q=f.colors||this.g.colors,r=e.length;if(this.raphael.is(e[0],"array")){m=[],p=r,r=0;for(var s=e.length;s--;)j.push(this.set()),m.push(Math.max.apply(Math,e[s])),r=Math.max(r,e[s].length);if(f.stacked)for(var s=r;s--;){var t=0;for(var u=e.length;u--;)t+=+e[u][s]||0;n.push(t)}for(var s=e.length;s--;)if(e[s].length<r)for(var u=r;u--;)e[s].push(0);m=Math.max.apply(Math,f.stacked?n:m)}m=f.to||m;var v=c/(r*(100+h)+h)*100,w=v*h/100,x=f.vgutter==null?20:f.vgutter,y=[],z=a+w,A=(d-2*x)/m;f.stretch||(w=Math.round(w),v=Math.floor(v)),!f.stacked&&(v/=p||1);for(var s=0;s<r;s++){y=[];for(var u=0;u<(p||1);u++){var B=Math.round((p?e[u][s]:e[s])*A),C=b+d-x-B,D=this.g.finger(Math.round(z+v/2),C+B,v,B,!0,g).attr({stroke:q[p?u:s],fill:q[p?u:s]});p?j[u].push(D):j.push(D),D.y=C,D.x=Math.round(z+v/2),D.w=v,D.h=B,D.value=p?e[u][s]:e[s],f.stacked?y.push(D):z+=v}if(f.stacked){var E;l.push(E=this.rect(y[0].x-y[0].w/2,b,v,d).attr(this.g.shim)),E.bars=this.set();var F=0;for(var G=y.length;G--;)y[G].toFront();for(var G=0,H=y.length;G<H;G++){var D=y[G],I,B=(F+D.value)*A,J=this.g.finger(D.x,b+d-x-!!F*.5,v,B,!0,g,1);E.bars.push(D),F&&D.attr({path:J}),D.h=B,D.y=b+d-x-!!F*.5-B,k.push(I=this.rect(D.x-D.w/2,D.y,v,D.value*A).attr(this.g.shim)),I.bar=D,I.value=D.value,F+=D.value}z+=v}z+=w}l.toFront(),z=a+w;if(!f.stacked)for(var s=0;s<r;s++){for(var u=0;u<(p||1);u++){var I;k.push(I=this.rect(Math.round(z),b+x,v,d-x).attr(this.g.shim)),I.bar=p?j[u][s]:j[s],I.value=I.bar.value,z+=v}z+=w}return i.label=function(a,c){a=a||[],this.labels=o.set();var g,h=-Infinity;if(f.stacked)for(var i=0;i<r;i++){var l=0;for(var n=0;n<(p||1);n++){l+=p?e[n][i]:e[i];if(n==p-1){var q=o.g.labelise(a[i],l,m);g=o.g.text(j[i*(p||1)+n].x,b+d-x/2,q).insertBefore(k[i*(p||1)+n]);var s=g.getBBox();s.x-7<h?g.remove():(this.labels.push(g),h=s.x+s.width)}}}else for(var i=0;i<r;i++)for(var n=0;n<(p||1);n++){var q=o.g.labelise(p?a[n]&&a[n][i]:a[i],p?e[n][i]:e[i],m);g=o.g.text(j[i*(p||1)+n].x,c?b+d-x/2:j[i*(p||1)+n].y-10,q).insertBefore(k[i*(p||1)+n]);var s=g.getBBox();s.x-7<h?g.remove():(this.labels.push(g),h=s.x+s.width)}return this},i.hover=function(a,b){return l.hide(),k.show(),k.mouseover(a).mouseout(b),this},i.hoverColumn=function(a,b){return k.hide(),l.show(),b=b||function(){},l.mouseover(a).mouseout(b),this},i.click=function(a){return l.hide(),k.show(),k.click(a),this},i.each=function(a){if(!Raphael.is(a,"function"))return this;for(var b=k.length;b--;)a.call(k[b]);return this},i.eachColumn=function(a){if(!Raphael.is(a,"function"))return this;for(var b=l.length;b--;)a.call(l[b]);return this},i.clickColumn=function(a){return k.hide(),l.show(),l.click(a),this},i.push(j,k,l),i.bars=j,i.covers=k,i},Raphael.fn.g.hbarchart=function(a,b,c,d,e,f){f=f||{};var g={round:"round",sharp:"sharp",soft:"soft"}[f.type]||"square",h=parseFloat(f.gutter||"20%"),i=this.set(),j=this.set(),k=this.set(),l=this.set(),m=Math.max.apply(Math,e),n=[],o=this,p=0,q=f.colors||this.g.colors,r=e.length;if(this.raphael.is(e[0],"array")){m=[],p=r,r=0;for(var s=e.length;s--;)j.push(this.set()),m.push(Math.max.apply(Math,e[s])),r=Math.max(r,e[s].length);if(f.stacked)for(var s=r;s--;){var t=0;for(var u=e.length;u--;)t+=+e[u][s]||0;n.push(t)}for(var s=e.length;s--;)if(e[s].length<r)for(var u=r;u--;)e[s].push(0);m=Math.max.apply(Math,f.stacked?n:m)}m=f.to||m;var v=Math.floor(d/(r*(100+h)+h)*100),w=Math.floor(v*h/100),x=[],y=b+w,z=(c-1)/m;!f.stacked&&(v/=p||1);for(var s=0;s<r;s++){x=[];for(var u=0;u<(p||1);u++){var A=p?e[u][s]:e[s],B=this.g.finger(a,y+v/2,Math.round(A*z),v-1,!1,g).attr({stroke:q[p?u:s],fill:q[p?u:s]});p?j[u].push(B):j.push(B),B.x=a+Math.round(A*z),B.y=y+v/2,B.w=Math.round(A*z),B.h=v,B.value=+A,f.stacked?x.push(B):y+=v}if(f.stacked){var C=this.rect(a,x[0].y-x[0].h/2,c,v).attr(this.g.shim);l.push(C),C.bars=this.set();var D=0;for(var E=x.length;E--;)x[E].toFront();for(var E=0,F=x.length;E<F;E++){var B=x[E],G,A=Math.round((D+B.value)*z),H=this.g.finger(a,B.y,A,v-1,!1,g,1);C.bars.push(B),D&&B.attr({path:H}),B.w=A,B.x=a+A,k.push(G=this.rect(a+D*z,B.y-B.h/2,B.value*z,v).attr(this.g.shim)),G.bar=B,D+=B.value}y+=v}y+=w}l.toFront(),y=b+w;if(!f.stacked)for(var s=0;s<r;s++){for(var u=0;u<p;u++){var G=this.rect(a,y,c,v).attr(this.g.shim);k.push(G),G.bar=j[u][s],y+=v}y+=w}return i.label=function(b,c){b=b||[],this.labels=o.set();for(var d=0;d<r;d++)for(var f=0;f<p;f++){var g=o.g.labelise(p?b[f]&&b[f][d]:b[d],p?e[f][d]:e[d],m),h=c?j[d*(p||1)+f].x-v/2+3:a+5,i=c?"end":"start",l;this.labels.push(l=o.g.text(h,j[d*(p||1)+f].y,g).attr({"text-anchor":i}).insertBefore(k[0])),l.getBBox().x<a+5?l.attr({x:a+5,"text-anchor":"start"}):j[d*(p||1)+f].label=l}return this},i.hover=function(a,b){return l.hide(),k.show(),b=b||function(){},k.mouseover(a).mouseout(b),this},i.hoverColumn=function(a,b){return k.hide(),l.show(),b=b||function(){},l.mouseover(a).mouseout(b),this},i.each=function(a){if(!Raphael.is(a,"function"))return this;for(var b=k.length;b--;)a.call(k[b]);return this},i.eachColumn=function(a){if(!Raphael.is(a,"function"))return this;for(var b=l.length;b--;)a.call(l[b]);return this},i.click=function(a){return l.hide(),k.show(),k.click(a),this},i.clickColumn=function(a){return k.hide(),l.show(),l.click(a),this},i.push(j,k,l),i.bars=j,i.covers=k,i}
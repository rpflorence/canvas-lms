define(function(){var a=this,b=a._,c=function(a){this._wrapped=a},d=typeof StopIteration!="undefined"?StopIteration:"__break__",e=a._=function(a){return new c(a)};typeof exports!="undefined"&&(exports._=e);var f=Array.prototype.slice,g=Array.prototype.unshift,h=Object.prototype.toString,i=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;e.VERSION="0.5.1",e.each=function(a,b,c){var f=0;try{if(a.forEach)a.forEach(b,c);else if(e.isArray(a)||e.isArguments(a))for(var g=0,h=a.length;g<h;g++)b.call(c,a[g],g,a);else{var i=e.keys(a),h=i.length;for(var g=0;g<h;g++)b.call(c,a[i[g]],i[g],a)}}catch(j){if(j!=d)throw j}return a},e.map=function(a,b,c){if(a&&e.isFunction(a.map))return a.map(b,c);var d=[];return e.each(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d},e.reduce=function(a,b,c,d){return a&&e.isFunction(a.reduce)?a.reduce(e.bind(c,d),b):(e.each(a,function(a,e,f){b=c.call(d,b,a,e,f)}),b)},e.reduceRight=function(a,b,c,d){if(a&&e.isFunction(a.reduceRight))return a.reduceRight(e.bind(c,d),b);var f=e.clone(e.toArray(a)).reverse();return e.each(f,function(e,f){b=c.call(d,b,e,f,a)}),b},e.detect=function(a,b,c){var d;return e.each(a,function(a,f,g){b.call(c,a,f,g)&&(d=a,e.breakLoop())}),d},e.select=function(a,b,c){if(a&&e.isFunction(a.filter))return a.filter(b,c);var d=[];return e.each(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d},e.reject=function(a,b,c){var d=[];return e.each(a,function(a,e,f){!b.call(c,a,e,f)&&d.push(a)}),d},e.all=function(a,b,c){b=b||e.identity;if(a&&e.isFunction(a.every))return a.every(b,c);var d=!0;return e.each(a,function(a,f,g){(d=d&&b.call(c,a,f,g))||e.breakLoop()}),d},e.any=function(a,b,c){b=b||e.identity;if(a&&e.isFunction(a.some))return a.some(b,c);var d=!1;return e.each(a,function(a,f,g){(d=b.call(c,a,f,g))&&e.breakLoop()}),d},e.include=function(a,b){if(e.isArray(a))return e.indexOf(a,b)!=-1;var c=!1;return e.each(a,function(a){(c=a===b)&&e.breakLoop()}),c},e.invoke=function(a,b){var c=e.rest(arguments,2);return e.map(a,function(a){return(b?a[b]:a).apply(a,c)})},e.pluck=function(a,b){return e.map(a,function(a){return a[b]})},e.max=function(a,b,c){if(!b&&e.isArray(a))return Math.max.apply(Math,a);var d={computed:-Infinity};return e.each(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},e.min=function(a,b,c){if(!b&&e.isArray(a))return Math.min.apply(Math,a);var d={computed:Infinity};return e.each(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},e.sortBy=function(a,b,c){return e.pluck(e.map(a,function(a,d,e){return{value:a,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}),"value")},e.sortedIndex=function(a,b,c){c=c||e.identity;var d=0,f=a.length;while(d<f){var g=d+f>>1;c(a[g])<c(b)?d=g+1:f=g}return d},e.toArray=function(a){return a?a.toArray?a.toArray():e.isArray(a)?a:e.isArguments(a)?f.call(a):e.map(a,function(a){return a}):[]},e.size=function(a){return e.toArray(a).length},e.first=function(a,b,c){return b&&!c?f.call(a,0,b):a[0]},e.rest=function(a,b,c){return f.call(a,e.isUndefined(b)||c?1:b)},e.last=function(a){return a[a.length-1]},e.compact=function(a){return e.select(a,function(a){return!!a})},e.flatten=function(a){return e.reduce(a,[],function(a,b){return e.isArray(b)?a.concat(e.flatten(b)):(a.push(b),a)})},e.without=function(a){var b=e.rest(arguments);return e.select(a,function(a){return!e.include(b,a)})},e.uniq=function(a,b){return e.reduce(a,[],function(a,c,d){return(0==d||(b===!0?e.last(a)!=c:!e.include(a,c)))&&a.push(c),a})},e.intersect=function(a){var b=e.rest(arguments);return e.select(e.uniq(a),function(a){return e.all(b,function(b){return e.indexOf(b,a)>=0})})},e.zip=function(){var a=e.toArray(arguments),b=e.max(e.pluck(a,"length")),c=new Array(b);for(var d=0;d<b;d++)c[d]=e.pluck(a,String(d));return c},e.indexOf=function(a,b){if(a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},e.lastIndexOf=function(a,b){if(a.lastIndexOf)return a.lastIndexOf(b);var c=a.length;while(c--)if(a[c]===b)return c;return-1},e.range=function(a,b,c){var d=e.toArray(arguments),f=d.length<=1,a=f?0:d[0],b=f?d[0]:d[1],c=d[2]||1,g=Math.ceil((b-a)/c);if(g<=0)return[];var h=new Array(g);for(var i=a,j=0;!0;i+=c)if((c>0?i-b:b-i)<0)h[j++]=i;else return h},e.bind=function(b,c){var d=e.rest(arguments,2);return function(){return b.apply(c||a,d.concat(e.toArray(arguments)))}},e.bindAll=function(a){var b=e.rest(arguments);return b.length==0&&(b=e.functions(a)),e.each(b,function(b){a[b]=e.bind(a[b],a)}),a},e.delay=function(a,b){var c=e.rest(arguments,2);return setTimeout(function(){return a.apply(a,c)},b)},e.defer=function(a){return e.delay.apply(e,[a,1].concat(e.rest(arguments)))},e.wrap=function(a,b){return function(){var c=[a].concat(e.toArray(arguments));return b.apply(b,c)}},e.compose=function(){var a=e.toArray(arguments);return function(){var b=e.toArray(arguments);for(var c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},e.keys=function(a){if(e.isArray(a))return e.range(0,a.length);var b=[];for(var c in a)i.call(a,c)&&b.push(c);return b},e.values=function(a){return e.map(a,e.identity)},e.functions=function(a){return e.select(e.keys(a),function(b){return e.isFunction(a[b])}).sort()},e.extend=function(a,b){for(var c in b)a[c]=b[c];return a},e.clone=function(a){return e.isArray(a)?a.slice(0):e.extend({},a)},e.isEqual=function(a,b){if(a===b)return!0;var c=typeof a,d=typeof b;if(c!=d)return!1;if(a==b)return!0;if(!a&&b||a&&!b)return!1;if(a.isEqual)return a.isEqual(b);if(e.isDate(a)&&e.isDate(b))return a.getTime()===b.getTime();if(e.isNaN(a)&&e.isNaN(b))return!0;if(e.isRegExp(a)&&e.isRegExp(b))return a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline;if(c!=="object")return!1;if(a.length&&a.length!==b.length)return!1;var f=e.keys(a),g=e.keys(b);if(f.length!=g.length)return!1;for(var h in a)if(!e.isEqual(a[h],b[h]))return!1;return!0},e.isEmpty=function(a){return e.keys(a).length==0},e.isElement=function(a){return!!a&&a.nodeType==1},e.isArguments=function(a){return a&&e.isNumber(a.length)&&!e.isArray(a)&&!j.call(a,"length")},e.isNaN=function(a){return e.isNumber(a)&&isNaN(a)},e.isNull=function(a){return a===null},e.isUndefined=function(a){return typeof a=="undefined"};var k=["Array","Date","Function","Number","RegExp","String"];for(var l=0,m=k.length;l<m;l++)(function(){var a="[object "+k[l]+"]";e["is"+k[l]]=function(b){return h.call(b)==a}})();e.noConflict=function(){return a._=b,this},e.identity=function(a){return a},e.breakLoop=function(){throw d};var n=0;e.uniqueId=function(a){var b=n++;return a?a+b:b},e.template=function(a,b){var c=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return b?c(b):c},e.forEach=e.each,e.foldl=e.inject=e.reduce,e.foldr=e.reduceRight,e.filter=e.select,e.every=e.all,e.some=e.any,e.head=e.first,e.tail=e.rest,e.methods=e.functions;var o=function(a,b){return b?e(a).chain():a};return e.each(e.functions(e),function(a){var b=e[a];c.prototype[a]=function(){return g.call(arguments,this._wrapped),o(b.apply(e,arguments),this._chain)}}),e.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=Array.prototype[a];c.prototype[a]=function(){return b.apply(this._wrapped,arguments),o(this._wrapped,this._chain)}}),e.each(["concat","join","slice"],function(a){var b=Array.prototype[a];c.prototype[a]=function(){return o(b.apply(this._wrapped,arguments),this._chain)}}),c.prototype.chain=function(){return this._chain=!0,this},c.prototype.value=function(){return this._wrapped},e})
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["INST","jquery","jquery.instructure_misc_helpers"],function(b,c){var d;return d=function(){function b(){}return b.calculate=function(b,d,e){var f;return f={},f.group_sums=c.map(d,a(function(a){return{group:a,current:this.create_group_sum(a,b,!0),"final":this.create_group_sum(a,b,!1)}},this)),f.current=this.calculate_total(f.group_sums,!0,e),f["final"]=this.calculate_total(f.group_sums,!1,e),f},b.create_group_sum=function(a,b,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;l={submissions:[],score:0,possible:0,submission_count:0},w=a.assignments;for(m=0,q=w.length;m<q;m++){e=w[m],f={score:0,possible:0,percent:0,drop:!1,submitted:!1},k=c.detect(b,function(){return this.assignment_id===e.id}),k==null&&(k={score:null}),k.assignment_group_id=a.id,(x=k.points_possible)==null&&(k.points_possible=e.points_possible),f.submission=k,l.submissions.push(f);if(!d||k.score!=null&&k.score!=="")f.score=this.parse(k.score),f.possible=this.parse(e.points_possible),f.percent=this.parse(f.score/f.possible),f.submitted=k.score!=null&&k.score!=="",f.submitted&&(l.submission_count+=1)}l.submissions.sort(function(a,b){return a.percent-b.percent}),i=c.extend({drop_lowest:0,drop_highest:0,never_drop:[]},a.rules),g=0,y=["low","high"];for(n=0,r=y.length;n<r;n++){h=y[n],z=l.submissions;for(o=0,s=z.length;o<s;o++)f=z[o],!f.drop&&i["drop_"+h+"est"]>0&&c.inArray(f.assignment_id,i.never_drop)===-1&&f.possible>0&&f.submitted&&(f.drop=!0,(A=f.submission)!=null&&(A.drop=!0),i["drop_"+h+"est"]-=1,g+=1)}g>0&&g===l.submission_count&&(l.submissions[l.submissions.length-1].drop=!1,(B=l.submissions[l.submissions.length-1].submission)!=null&&(B.drop=!1),g-=1),l.submission_count-=g,C=l.submissions;for(p=0,t=C.length;p<t;p++)j=C[p],j.drop||(l.score+=j.score);D=l.submissions;for(v=0,u=D.length;v<u;v++)j=D[v],j.drop||(l.possible+=j.possible);return l},b.calculate_total=function(a,b,c){var d,e,f,g,h,i,j,k,l;e=b?"current":"final";if(c==="percent"){h=0,g=0,j=0;for(k=0,l=a.length;k<l;k++)d=a[k],d.group.group_weight>0&&(d[e].submission_count>0&&d[e].possible>0&&(i=d[e].score/d[e].possible,h+=d.group.group_weight*i,g+=d.group.group_weight),j+=d.group.group_weight);return b&&g<100&&(f=j<100?j:100,h=h*f/g),{score:h,possible:100}}return{score:this.sum(function(){var b,c,f;f=[];for(b=0,c=a.length;b<c;b++)d=a[b],f.push(d[e].score);return f}()),possible:this.sum(function(){var b,c,f;f=[];for(b=0,c=a.length;b<c;b++)d=a[b],f.push(d[e].possible);return f}())}},b.sum=function(a){var b,c,d,e;b=0;for(d=0,e=a.length;d<e;d++)c=a[d],b+=c;return b},b.parse=function(a){var b;return b=parseFloat(a),b&&isFinite(b)?b:0},b.letter_grade=function(a,b){var d,e;return b<0&&(b=0),e=c.grep(a,function(c,d){return b>=c[1]*100||d===a.length-1}),d=e[0],d[0]},b}(),window.INST.GradeCalculator=d})}).call(this)
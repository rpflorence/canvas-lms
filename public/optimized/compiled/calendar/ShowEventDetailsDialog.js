(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define("compiled/calendar/ShowEventDetailsDialog",["i18n","compiled/util/Popover","compiled/calendar/CommonEvent","compiled/calendar/EditEventDetailsDialog","jst/calendar/eventDetails","jst/calendar/deleteItem"],function(b,c,d,e,f,g){var h;return b=b.scoped("calendar"),h=function(){function d(b){this.show=a(this.show,this),this.unreserveEvent=a(this.unreserveEvent,this),this.reserveEvent=a(this.reserveEvent,this),this.deleteEvent=a(this.deleteEvent,this),this.showEditDialog=a(this.showEditDialog,this),this.event=b,this.contexts=b.contexts}return d.prototype.showEditDialog=function(){return this.popover.hide(),(new e(this.event)).show()},d.prototype.deleteEvent=function(c){var d;c==null&&(c=this.event);if(this.event.isNewEvent())return;return d=c.object.url,c.object.assignment&&(d=$.replaceTags(this.event.deleteURL,"id",this.event.object.id)),$("<div />").confirmDelete({url:d,message:$(g({message:c.deleteConfirmation,hide_reason:c.object.workflow_state!=="locked"})),dialog:{title:b.t("confirm_deletion","Confirm Deletion")},prepareData:a(function(a){return{cancel_reason:a.find("#cancel_reason").val()}},this),confirmed:a(function(){return this.popover.hide(),$.publish("CommonEvent/eventDeleting",c)},this),success:a(function(){return $.publish("CommonEvent/eventDeleted",c)},this)})},d.prototype.reserveEvent=function(){var b,c,d;d=this.event.object.reserve_url,c=a(function(a){return this.popover.hide(),$.publish("CommonEvent/eventSaved",this.event)},this),b=a(function(a){return alert("Could not reserve event: "+a),$.publish("CommonEvent/eventSaveFailed",this.event)},this);if(confirm("Are you sure you want to sign up for this time slot?"))return $.publish("CommonEvent/eventSaving",this.event),$.ajaxJSON(d,"POST",{},c,b)},d.prototype.unreserveEvent=function(){var a,b,c,d,e;d=this.event.childEvents;for(b=0,c=d.length;b<c;b++){a=d[b];if((e=a.object)!=null?e.own_reservation:void 0){this.deleteEvent(a);return}}},d.prototype.show=function(b){var d,e,g,h,i,j,k,l,m,n,o;e=$.extend(!0,{},this.event,{can_reserve:(i=this.event.object)!=null?i.reserve_url:void 0}),this.event.contextInfo.can_create_appointment_groups&&(e.can_reserve=!1);if((j=this.event.object)!=null?j.child_events:void 0){this.event.object.reserved&&(e.can_unreserve=!0,e.can_reserve=!1),k=this.event.object.child_events;for(g=0,h=k.length;g<h;g++)d=k[g],d.user&&((l=e.reserved_users)!=null?l:e.reserved_users=[]).push({id:d.user.id,name:d.user.short_name}),d.group&&((m=e.reserved_groups)!=null?m:e.reserved_groups=[]).push({id:d.group.id,name:d.group.name})}return((n=this.event.object)!=null?n.available_slots:void 0)===0?(e.can_reserve=!1,e.availableSlotsText="None"):((o=this.event.object)!=null?o.available_slots:void 0)>0&&(e.availableSlotsText=this.event.object.available_slots),this.popover=new c(b,f(e)),this.popover.el.find(".edit_event_link").click(a(function(a){return a.preventDefault(),this.showEditDialog()},this)),this.popover.el.find(".delete_event_link").click(a(function(a){return a.preventDefault(),this.deleteEvent()},this)),this.popover.el.find(".reserve_event_link").click(a(function(a){return a.preventDefault(),this.reserveEvent()},this)),this.popover.el.find(".unreserve_event_link").click(a(function(a){return a.preventDefault(),this.unreserveEvent()},this))},d}()})}).call(this)
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1};define("compiled/calendar/sidebar",["i18n","jst/calendar/contextList","jst/calendar/undatedEvents","compiled/calendar/commonEventFactory","compiled/calendar/EditEventDetailsDialog","compiled/calendar/EventDataSource"],function(c,d,e,f,g,h){var i,j;return c=c.scoped("calendar"),i=function(){function c(b,c){var d,e,f;this.$holder=c,this.restoreList=a(this.restoreList,this),this.saveAndClear=a(this.saveAndClear,this),e=function(){try{return $.parseJSON($.decodeFromHex(location.hash.substring(1)))||{}}catch(a){return{}}}(),f=$.store.userGet("checked_calendar_codes"),e.show&&(this.contexts=e.show.split(",")),f&&(this.contexts||(this.contexts=f.split(","))),this.contexts||(this.contexts=function(){var a,c,e,f;e=b.slice(0,10),f=[];for(a=0,c=e.length;a<c;a++)d=e[a],f.push(d.asset_string);return f}()),this.notify(),$.subscribe("Calendar/saveVisibleContextListAndClear",this.saveAndClear),$.subscribe("Calendar/restoreVisibleContextList",this.restoreList)}return c.prototype.saveAndClear=function(){if(!this.savedContexts)return this.savedContexts=this.contexts,this.contexts=[],this.notify()},c.prototype.restoreList=function(){if(this.savedContexts)return this.contexts=this.savedContexts,this.savedContexts=null,this.notify()},c.prototype.toggle=function(a){var b;return b=$.inArray(a,this.contexts),b<0?(this.contexts.push(a),this.contexts.length>10&&this.contexts.shift):this.contexts.splice(b,1),this.notify()},c.prototype.notify=function(){return $.publish("Calendar/visibleContextListChanged",[this.contexts]),this.$holder.find(".context_list_context").each(a(function(a,c){var d,e,f;return d=$(c),e=(f=d.data("context"),b.call(this.contexts,f)>=0),d.toggleClass("checked",e).toggleClass("not-checked",!e)},this))},c}(),j=function(a,b){var c,e,h,j,k;for(j=0,k=a.length;j<k;j++)e=a[j],e.can_create_stuff=e.can_create_calendar_events||e.can_create_assignments;return c=$("#context-list-holder"),c.html(d({contexts:a})),h=new i(a,c),c.find(".settings").kyleMenu({buttonOpts:{icons:{primary:"ui-icon-cog-with-droparrow",secondary:null}}}),c.delegate(".context_list_context","click",function(a){if(!$(a.target).closest(".settings").length)return h.toggle($(this).data("context"))}),c.delegate(".context_list_context",{"mouseenter mouseleave":function(a){var b;return b=a.type!=="mouseleave"||!!$(this).find(".ui-menu:visible").length,$(this).toggleClass("hovering",b)},"popupopen popupclose":function(a){var b;return b=a.type==="popupopen",$(this).toggleClass("hovering",b).find(".settings").toggleClass("ui-state-active",b)}}),c.delegate(".actions a","click",function(){var b,c,d;c=$(this).parents("li[data-context]").data("context"),b=$(this).data("action");if(b==="add_event"||b==="add_assignment"){d=f(null,a),(new g(d)).show(),$('select[class="context_id"]').val(c);if(b==="add_assignment")return $('a[href="#edit_assignment_form"]').click()}})}})}).call(this)
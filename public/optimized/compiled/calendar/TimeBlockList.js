(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define("compiled/calendar/TimeBlockList",["compiled/calendar/TimeBlockListManager","jst/calendar/timeBlockList","jst/calendar/_timeBlock"],function(b,c,d){return function(){function e(c,d,e){this.splitClick=a(this.splitClick,this),this.addRow=a(this.addRow,this),this.inputFocus=a(this.inputFocus,this),this.deleteClick=a(this.deleteClick,this),this.inputBlur=a(this.inputBlur,this),this.inputChange=a(this.inputChange,this),this.render=a(this.render,this),this.div=$(c),this.splitterDiv=$(d),this.blocksManager=new b(e),this.render(),this.splitterDiv.find(".split-link").click(this.splitClick)}return e.prototype.render=function(a){var b,d,e,f,g,h,i,j,k;d={time_blocks:a||[]};if(a==null){j=this.blocksManager.blocks;for(f=0,h=j.length;f<h;f++)b=j[f],d.time_blocks.push({formatted_date:b.start.toString("MMM d, yyyy"),formatted_start_time:b.start.toString("h:mmtt"),formatted_end_time:b.end.toString("h:mmtt"),locked:b.locked})}this.div.html(c(d)),k=this.div.find("tr");for(g=0,i=k.length;g<i;g++)e=k[g],this.addHandlers(e);return this.lastRow=this.div.find("tr:last")},e.prototype.addHandlers=function(a){var b;return b=$(a),b.find('.date_field[disabled!="disabled"]').date_field(),b.find('.time_field[disabled!="disabled"]').time_field(),b.find("input").change(this.inputChange),b.find("input").blur(this.inputBlur),b.find("input").focus(this.inputFocus),b.find(".delete-block-link").click(this.deleteClick)},e.prototype.inputChange=function(a){var b,c,d,e;d=a.target,c=$(d).closest("tr");if(c.get(0)===this.div.find(".time-block-list-body tr:last").get(0))return this.addRow(),e=this.div.find(".time-block-list-body").find("tr").length,b=this.div.find(".time-block-list-body").find("tr:nth-child("+(e-1)+")"),b.find("[name='"+d.name+"']").parent().next().find("input").focus()},e.prototype.inputBlur=function(a){var b,c,d,e,f,g,h;e=a.target,b=$(e);if(!!this.validField(e))return b.val(b.nextAll(".datetime_suggest").text());c=!0,h=b.closest("tr").find("input");for(f=0,g=h.length;f<g;f++)d=h[f],d.value!==""&&(c=!1);if(!c)return b.addClass("error")},e.prototype.deleteClick=function(a){a.preventDefault(),$(a.target).closest("tr").remove();if(this.div.find(".time-block-list-body").find('tr[class!="locked"]').length===0)return this.addRow()},e.prototype.inputFocus=function(b){var c,d;return d=b.target,c=$(d),c.removeClass("error"),this.div.find(".time-block-list-body").find("tr").each(a(function(a,b){var d;return d=$(b),b===c.closest("tr").get(0)?d.addClass("focused"):d.removeClass("focused")},this))},e.prototype.addRow=function(){return this.div.find(".time-block-list-body").append(d()),this.addHandlers(".time-block-list-body tr:last")},e.prototype.splitClick=function(a){var b;a.preventDefault(),b=this.splitterDiv.find("[name=duration]").val();if(b&&this.validate())return this.split(b),this.render()},e.prototype.split=function(a){return this.blocksManager.split(a)},e.prototype.validate=function(){var b,c;return c=!0,this.blocksManager.reset(),b=this.div.find(".time-block-list-body tr:last").get(0),this.div.find(".time-block-list-body").find("tr").each(a(function(a,d){var e,f,g,h,i,j,k,l,m,n;if(d===b)return;f=$(d),n=["date","start_time","end_time"];for(l=0,m=n.length;l<m;l++)i=n[l],e=f.find("[name='"+i+"']"),this.validField(e)||(c=!1);if(c)return g=f.getFormData(),k=Date.parse(""+g.date+" "+g.start_time),h=Date.parse(""+g.date+" "+g.end_time),j=$(d).hasClass("locked"),this.blocksManager.add(k,h,j)},this)),c||alert("There are errors in your time block selections."),c},e.prototype.validField=function(a){var b,c;return b=$(a),c=b.nextAll(".datetime_suggest").hasClass("invalid_datetime"),b.val()!==""&&!c},e.prototype.blocks=function(){var a,b,c,d,e;a=[],e=this.blocksManager.blocks;for(c=0,d=e.length;c<d;c++)b=e[c],b.locked||a.push([b.start,b.end]);return a},e}()})}).call(this)
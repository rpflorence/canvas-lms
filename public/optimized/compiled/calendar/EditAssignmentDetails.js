(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define("compiled/calendar/EditAssignmentDetails",["i18n","compiled/calendar/commonEventFactory","jst/calendar/editAssignment","jst/calendar/genericSelect"],function(b,c,d,e){var f;return f=function(){function b(b,c,e,f){this.event=c,this.contextChangeCB=e,this.closeCB=f,this.formSubmit=a(this.formSubmit,this),this.setupTimeAndDatePickers=a(this.setupTimeAndDatePickers,this),this.contextChange=a(this.contextChange,this),this.setContext=a(this.setContext,this),this.moreOptionsClick=a(this.moreOptionsClick,this),this.activate=a(this.activate,this),this.currentContextInfo=null,this.form=$(d({title:this.event.title,contexts:this.event.possibleContexts()})),$(b).append(this.form),this.setupTimeAndDatePickers(),this.form.submit(this.formSubmit),this.form.find(".more_options_link").click(this.moreOptionsClick),this.form.find("select.context_id").change(this.contextChange),this.form.find("select.context_id").triggerHandler("change",!1),this.event.isNewEvent()||(this.form.find(".context_select").hide(),this.form.attr("method","PUT"),this.form.attr("action",$.replaceTags(this.event.contextInfo.assignment_url,"id",this.event.object.id)))}return b.prototype.contextInfoForCode=function(a){var b,c,d,e;e=this.event.possibleContexts();for(c=0,d=e.length;c<d;c++){b=e[c];if(b.asset_string===a)return b}return null},b.prototype.activate=function(){var a;this.form.find("select.context_id").change();if((a=this.event.assignment)!=null?a.assignment_group_id:void 0)return this.form.find(".assignment_group_select .assignment_group").val(this.event.assignment.assignment_group_id)},b.prototype.moreOptionsClick=function(a){var b,c,d;return a.preventDefault(),d=$(event.target).attr("href").split("#"),b=this.form.getFormData({object_name:"assignment"}),c={},b.title&&(c.title=b.title),b.due_at&&(c.due_at=b.due_at),b.assignment_group_id&&(c.assignment_group_id=b.assignment_group_id),c.return_to=window.location.href,d[0]+="?"+$.param(c),window.location.href=d.join("#")},b.prototype.setContext=function(a){return this.form.find("select.context_id").val(a).triggerHandler("change",!1)},b.prototype.contextChange=function(a,b){var c,d;if(this.ignoreContextChange)return;d=$(a.target).val(),this.currentContextInfo=this.contextInfoForCode(d),this.event.contextInfo=this.currentContextInfo;if(this.currentContextInfo===null)return;return b!==!1&&this.contextChangeCB(d),c={cssClass:"assignment_group",name:"assignment[assignment_group_id]",collection:this.currentContextInfo.assignment_groups},this.form.find(".assignment_group_select").html(e(c)),this.form.attr("action",this.currentContextInfo.create_assignment_url),this.form.find(".more_options_link").attr("href",this.currentContextInfo.new_assignment_url)},b.prototype.setupTimeAndDatePickers=function(){var a,b;this.form.find(".datetime_field").datetime_field(),b=this.event.startDate(),a=this.event.endDate();if(this.event.allDay)return this.form.find(".datetime_field").val(b.toString("MMM d, yyyy")).change();if(b)return this.form.find(".datetime_field").val(b.toString("MMM d, yyyy h:mmtt")).change()},b.prototype.formSubmit=function(a){var b,d,e,f,g;return a.preventDefault(),d=this.form.getFormData()["assignment[due_at]"],d===""?b=null:b=this.form.find("#assignment_due_at").data("date"),g={"assignment[name]":this.form.find("#assignment_title").val(),"assignment[due_at]":b?$.dateToISO8601UTC($.unfudgeDateForProfileTimezone(b)):"","assignment[assignment_group_id]":this.form.find(".assignment_group").val()},this.event.isNewEvent()?(f={assignment:{title:g["assignment[name]"],due_at:b?$.dateToISO8601UTC(b):null,context_code:this.form.find(".context_id").val()}},e=c(f,this.event.possibleContexts()),e.save(g)):(this.event.title=g["assignment[name]"],this.event.start=b,this.event.save(g)),this.closeCB()},b}()})}).call(this)
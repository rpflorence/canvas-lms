(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define("compiled/calendar/EditAppointmentGroupDetails",["i18n","compiled/calendar/TimeBlockList","jst/calendar/editAppointmentGroup","jst/calendar/genericSelect"],function(b,c,d,e){var f;return f=function(){function b(b,e,f,g){var h,i,j,k,l;this.apptGroup=e,this.contextChangeCB=f,this.closeCB=g,this.contextChange=a(this.contextChange,this),this.save=a(this.save,this),this.saveClick=a(this.saveClick,this),this.saveWithoutPublishingClick=a(this.saveWithoutPublishingClick,this),this.currentContextInfo=null,$(b).html(d({title:this.apptGroup.title,contexts:this.apptGroup.contexts,appointment_group:this.apptGroup})),this.form=$(b).find("form"),this.form.find("select.context_id").change(this.contextChange).change(),this.apptGroup.id?(this.form.attr("action",this.apptGroup.url),this.form.find(".context_id").val(this.apptGroup.context_code).attr("disabled",!0),this.form.find("select.context_id").change(),this.form.find(".group_category").attr("disabled",!0),this.form.find(".course_section").attr("disabled",!0),this.form.find(".group-signup-checkbox").attr("disabled",!0),this.apptGroup.participant_type==="Group"?(this.form.find(".group-signup-checkbox").prop("checked",!0),this.form.find(".group_category").val(this.apptGroup.sub_context_code)):(this.form.find(".group-signup-checkbox").prop("checked",!1),this.apptGroup.sub_context_code?this.form.find(".course_section").val(this.apptGroup.sub_context_code):this.form.find(".course_section").val("all"))):this.form.attr("action",this.currentContextInfo.create_appointment_group_url),i=[];if(this.apptGroup.appointmentEvents){l=this.apptGroup.appointmentEvents;for(j=0,k=l.length;j<k;j++)h=l[j],i.push([h.start,h.end,!h.can_edit])}this.timeBlockList=new c(this.form.find(".time-block-list-body-wrapper"),this.form.find(".splitter"),i),this.form.find('[name="slot_duration"]').change(a(function(a){if(this.form.find('[name="autosplit_option"]').is(":checked"))return this.timeBlockList.split(a.target.value),this.timeBlockList.render()},this)),this.form.find('[name="participant_visibility"]').prop("checked",this.apptGroup.participant_visibility==="protected"),this.form.find(".group-signup-checkbox").change(a(function(a){var b;return b=!!a.target.checked,this.form.find(".per_appointment_groups_label").toggle(b),this.form.find(".per_appointment_users_label").toggle(!b),this.form.find(".section-signup").toggle(!b),this.form.find(".group-signup").toggle(b)},this)),this.form.find(".group-signup-checkbox").change(),this.form.find('[name="per_slot_option"]').change(a(function(a){var b,c;b=a.target,c=this.form.find('[name="participants_per_appointment"]');if(!b.checked)return c.attr("disabled",!0);c.attr("disabled",!1);if(c.val()==="")return c.val("1")},this)),this.apptGroup.participants_per_appointment>0?(this.form.find('[name="per_slot_option"]').prop("checked",!0),this.form.find('[name="participants_per_appointment"]').val(this.apptGroup.participants_per_appointment)):this.form.find('[name="participants_per_appointment"]').attr("disabled",!0),this.apptGroup.workflow_state==="active"&&this.form.find("#appointment-blocks-active-button").attr("disabled",!0).prop("checked",!0)}return b.prototype.contextInfoForCode=function(a){var b,c,d,e;e=this.apptGroup.contexts;for(c=0,d=e.length;c<d;c++){b=e[c];if(b.asset_string===a)return b}return null},b.prototype.saveWithoutPublishingClick=function(a){return a.preventDefault(),this.save(!1)},b.prototype.saveClick=function(a){return a.preventDefault(),this.save(!0)},b.prototype.save=function(b){var c,d,e,f,g,h,i,j,k,l,m;d=this.form.getFormData({object_name:"appointment_group"}),c=this.apptGroup.id===void 0,i={"appointment_group[title]":d.title,"appointment_group[description]":d.description,"appointment_group[location_name]":d.location},i["appointment_group[new_appointments]"]=[],this.timeBlockList.validate()||this["return"](!1),m=this.timeBlockList.blocks();for(k=0,l=m.length;k<l;k++)j=m[k],i["appointment_group[new_appointments]"].push([$.dateToISO8601UTC($.unfudgeDateForProfileTimezone(j[0])),$.dateToISO8601UTC($.unfudgeDateForProfileTimezone(j[1]))]);return d.per_slot_option==="1"&&d.participants_per_appointment&&(i["appointment_group[participants_per_appointment]"]=d.participants_per_appointment),b&&this.apptGroup.workflow_state!=="active"&&(i["appointment_group[publish]"]="1"),i["appointment_group[participant_visibility]"]=d.participant_visibility==="1"?"protected":"private",c&&(i["appointment_group[context_code]"]=d.context_code,d.use_group_signup==="1"&&d.group_category_id?i["appointment_group[sub_context_code]"]=d.group_category_id:d.section_id&&d.section_id!=="all"&&(i["appointment_group[sub_context_code]"]=d.section_id),i["appointment_group[max_appointments_per_participant]"]=1,i["appointment_group[min_appointments_per_participant]"]=1),h=a(function(){return this.closeCB(!0)},this),g=a(function(){},this),f=this.apptGroup.id?"PUT":"POST",e=$.ajaxJSON(this.form.attr("action"),f,i,h,g),this.form.disableWhileLoading(e)},b.prototype.contextChange=function(a){var b,c,d;b=$(a.target).val(),this.currentContextInfo=this.contextInfoForCode(b),this.apptGroup.contextInfo=this.currentContextInfo;if(this.currentContextInfo===null)return;this.currentContextInfo.course_sections&&(d={cssClass:"course_section",name:"section_id",collection:[{id:"all",name:"All Sections"}].concat(this.currentContextInfo.course_sections)},this.form.find(".section_select").html(e(d))),!this.currentContextInfo.group_categories||this.currentContextInfo.group_categories.length===0?this.form.find(".group-signup-checkbox").attr("disabled",!0).prop("checked",!1).change():this.currentContextInfo.group_categories&&(this.form.find(".group-signup-checkbox").attr("disabled",!1),c={cssClass:"group_category",name:"group_category_id",collection:this.currentContextInfo.group_categories},this.form.find(".group_select").html(e(c))),this.contextChangeCB(b);if(!this.apptGroup.id)return this.form.attr("action",this.currentContextInfo.create_appointment_group_url)},b}()})}).call(this)
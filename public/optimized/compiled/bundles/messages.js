define("vendor/jquery.placeholder",["jquery"],function(a){function b(b){this.input=b,b.attr("type")=="password"&&this.handlePassword(),a(b[0].form).submit(function(){b.hasClass("placeholder")&&b[0].value==b.attr("placeholder")&&(b[0].value="")})}b.prototype={show:function(a){if(this.input[0].value===""||a&&this.valueIsPlaceholder()){if(this.isPassword)try{this.input[0].setAttribute("type","text")}catch(b){this.input.before(this.fakePassword.show()).hide()}this.input.addClass("placeholder"),this.input[0].value=this.input.attr("placeholder")}},hide:function(){if(this.valueIsPlaceholder()&&this.input.hasClass("placeholder")){this.input.removeClass("placeholder"),this.input[0].value="";if(this.isPassword){try{this.input[0].setAttribute("type","password")}catch(a){}this.input.show(),this.input[0].focus()}}},valueIsPlaceholder:function(){return this.input[0].value==this.input.attr("placeholder")},handlePassword:function(){var b=this.input;b.attr("realType","password"),this.isPassword=!0;if(a.browser.msie&&b[0].outerHTML){var c=a(b[0].outerHTML.replace(/type=(['"])?password\1/gi,"type=$1text$1"));this.fakePassword=c.val(b.attr("placeholder")).addClass("placeholder").focus(function(){b.trigger("focus"),a(this).hide()}),a(b[0].form).submit(function(){c.remove(),b.show()})}}};var c="placeholder"in document.createElement("input");a.fn.placeholder=function(){return c?this:this.each(function(){var c=a(this),d=new b(c);d.show(!0),c.focus(function(){d.hide()}),c.blur(function(){d.show(!1)}),a.browser.msie&&(a(window).load(function(){c.val()&&c.removeClass("placeholder"),d.show(!0)}),c.focus(function(){if(this.value==""){var a=this.createTextRange();a.collapse(!0),a.moveStart("character",0),a.select()}}))})}}),define("vendor/jquery.elastic",["jquery"],function(a){a.fn.extend({elastic:function(b){var c=a.extend({},b),d=["paddingTop","paddingRight","paddingBottom","paddingLeft","borderLeftWidth","borderLeftStyle","borderRightWidth","borderRightStyle","fontSize","lineHeight","fontFamily","width","fontWeight"];return this.each(function(){function j(a,c){var d=Math.floor(parseInt(a,10));b.height()!=d&&b.css({height:d+"px",overflow:c})}function k(){var d=b.val().replace(/&/g,"&amp;").replace(/  /g,"&nbsp;").replace(/<|>/g,"&gt;").replace(/\n/g,"<br />"),i=e.html().replace(/<br>/ig,"<br />");if(d+"&nbsp;"!=i){e[0].innerHTML=d+"&nbsp;",e.width(b.width());var k=e.height();if(Math.abs(k+f-b.height())>3){var l=k+f;l<h?l>g?j(l,"hidden"):j(g,"hidden"):j(h,"auto"),a.isFunction(c.callback)&&c.callback()}}}if(this.type!="textarea")return!1;var b=a(this),e=a("<div />").css({position:"absolute",display:"none","word-wrap":"break-word"}).prependTo(b.parent()),f=parseInt(b.css("line-height"),10)||parseInt(b.css("font-size"),"10"),g=parseInt(b.css("height"),10)||f*3,h=parseInt(b.css("max-height"),10)||Number.MAX_VALUE,i=0;h<0&&(h=Number.MAX_VALUE),a.each(d,function(a,c){e.css(c,b.css(c))}),b.css({overflow:"hidden"}).bind("keyup change cut paste",k).bind("input paste",function(a){setTimeout(k,250)}),k()})}})}),define("vendor/jquery.cookie",["jquery"],function(a){jQuery.cookie=function(a,b,c){if(typeof b=="undefined"){var i=null;if(document.cookie&&document.cookie!=""){var j=document.cookie.split(";");for(var k=0;k<j.length;k++){var l=jQuery.trim(j[k]);if(l.substring(0,a.length+1)==a+"="){i=decodeURIComponent(l.substring(a.length+1));break}}}return i}c=c||{},b===null&&(b="",c.expires=-1);var d="";if(c.expires&&(typeof c.expires=="number"||c.expires.toUTCString)){var e;typeof c.expires=="number"?(e=new Date,e.setTime(e.getTime()+c.expires*24*60*60*1e3)):e=c.expires,d="; expires="+e.toUTCString()}var f=c.path?"; path="+c.path:"",g=c.domain?"; domain="+c.domain:"",h=c.secure?"; secure":"";document.cookie=[a,"=",encodeURIComponent(b),d,f,g,h].join("")}}),function(){define("compiled/slideshow",["i18n","jquery","str/htmlEscape","jquery.instructure_jquery_patches","jquery.instructure_misc_helpers"],function(a,b,c){var d,e;return a=a.scoped("slideshow"),d=function(){function a(a,d){var e,f;this.title=a,this.slideshow=d,this.body=b("<li/>").addClass("slide"),this.slideshow.slides.append(this.body),this.prevSlide=this.slideshow.slideObjects[this.slideshow.slideObjects.length-1],(f=this.prevSlide)!=null&&(f.nextSlide=this),this.nextSlide=null,this.indicator=b("<a/>").addClass("slide").attr("href","#").attr("title",c(this.title)).html("&nbsp;"),this.indicator.data("slide",this),this.slideshow.navigation.append(this.indicator),e=this,this.indicator.click(function(){return d.showSlide(e),!1}),this.hide()}return a.prototype.addParagraph=function(a,d){var e;return e=b("<p/>"),d!=null&&e.addClass(d),e.html(c(a)),this.body.append(e)},a.prototype.addImage=function(a,c,d){var e,f;return e=b("<img/>").attr("src",a),c!=null&&e.addClass(c),d?(f=b("<a/>").attr("href",d).attr("target","_blank"),f.append(e),this.body.append(f)):this.body.append(e)},a.prototype.show=function(){return this.body.show(),this.indicator.addClass("current_slide")},a.prototype.hide=function(){return this.indicator.removeClass("current_slide"),this.body.hide()},a}(),e=function(){function e(d){var e;e=this,this.dom=b("<div/>").attr("id",d),this.slides=b("<ul/>").addClass("slides"),this.dom.append(this.slides),this.separator=b("<div/>").addClass("separator"),this.dom.append(this.separator),this.navigation=b("<div/>").addClass("navigation"),this.dom.append(this.navigation),this.backButton=b("<a/>").addClass("back").attr("href","#").attr("title",c(a.t("titles.back","Back"))).html("&nbsp;"),this.navigation.append(this.backButton),this.backButton.click(function(){return e.showPrevSlide(),!1}),this.forwardButton=b("<a/>").addClass("forward").attr("href","#").attr("title",c(a.t("titles.forward","Forward"))).html("&nbsp;"),this.navigation.append(this.forwardButton),this.forwardButton.click(function(){return e.showNextSlide(),!1}),this.closeButton=b("<a/>").addClass("close").attr("href","#").attr("title",c(a.t("titles.close","Close"))).html("&nbsp;"),this.navigation.append(this.closeButton),this.closeButton.click(function(){return e.close(),!1}),this.slideObjects=[],this.slideShown=null}return e.prototype.addSlide=function(a,b){var c;return c=new d(a,this),this.slideObjects.push(c),b(c)},e.prototype.start=function(){return this.showSlide(this.slideObjects[0]),this.dialog=this.dom.dialog({dialogClass:"slideshow_dialog",height:529,width:700,modal:!0,draggable:!1,resizable:!1})},e.prototype.showSlide=function(a){var b;if(a){if(!this.slideShown||a!==this.slideShown)(b=this.slideShown)!=null&&b.hide(),this.slideShown=a,this.slideShown.show();return this.slideShown.prevSlide?this.backButton.removeClass("inactive"):this.backButton.addClass("inactive"),this.slideShown.nextSlide?this.forwardButton.removeClass("inactive"):this.forwardButton.addClass("inactive")}},e.prototype.showPrevSlide=function(){var a;return this.showSlide((a=this.slideShown)!=null?a.prevSlide:void 0)},e.prototype.showNextSlide=function(){var a;return this.showSlide((a=this.slideShown)!=null?a.nextSlide:void 0)},e.prototype.close=function(){var a;return this.dom.dialog("close"),this.dom.hide(),(a=this.slideShown)!=null&&a.hide(),this.slideShown=null},e}(),e})}.call(this),function(){define("compiled/conversations_intro",["i18n","compiled/slideshow","jquery.ajaxJSON"],function(a,b){return a=a.scoped("conversations_intro"),function(){var c;return c=new b("conversations_intro"),c.addSlide(a.t("titles.slide1","Slide 1"),function(b){return b.addImage("/images/conversations/intro/icon.png","icon"),b.addParagraph(a.t("slide1.paragraph1","Take a look at your Inbox!"),"large"),b.addParagraph(a.t("slide1.paragraph2","Conversations—the new Canvas messaging system—has arrived!"),"large"),b.addParagraph(a.t("slide1.paragraph3","Use Conversations to send a private message to a classmate or use Conversations to talk to an entire group of people."),"large_and_blue"),b.addParagraph(a.t("slide1.paragraph4","Ready for a short intro? Click the right arrow to get started."),"large")}),c.addSlide(a.t("titles.slide2","Slide 2"),function(b){return b.addImage("/images/conversations/intro/image2.png","screenshot"),b.addParagraph(a.t("slide2.paragraph1","All your conversations are shown on the left side.")),b.addParagraph(a.t("slide2.paragraph2","You can see who the conversation is with, how many messages there are, and a few lines from the newest message in each conversation."))}),c.addSlide(a.t("titles.slide3","Slide 3"),function(b){return b.addImage("/images/conversations/intro/image3.png","screenshot"),b.addParagraph(a.t("slide3.paragraph1",'Conversations can be marked as read/unread, archived, or labeled by color using the "actions" button on the message.')),b.addParagraph(a.t("slide3.paragraph2","Archived messages aren't deleted, they're just moved out of your inbox, so you can access them again if needed."))}),c.addSlide(a.t("titles.slide4","Slide 4"),function(b){return b.addImage("/images/conversations/intro/image4.png","screenshot"),b.addParagraph(a.t("slide4.paragraph1","When you select a conversation, all the messages for that conversation are shown in the panel on the right. When conversations get long, you can always scroll down to see earlier messages."))}),c.addSlide(a.t("titles.slide5","Slide 5"),function(b){return b.addImage("/images/conversations/intro/image5.png","screenshot"),b.addParagraph(a.t("slide5.paragraph1","To begin a message, start by clicking the Compose icon."))}),c.addSlide(a.t("titles.slide6","Slide 6"),function(b){return b.addImage("/images/conversations/intro/image6.png","screenshot"),b.addParagraph(a.t("slide6.paragraph1","In the New Message box, start typing the person, or group's name, and they'll show up in the dropdown. Alternatively, you can click the address book icon to find someone if you don't remember a name.")),b.addParagraph(a.t("slide6.paragraph2","Type your message, click Send, and you're golden."))}),c.addSlide(a.t("titles.slide7","Slide 7"),function(b){return b.addImage("/images/conversations/intro/image7.png","screenshot"),b.addParagraph(a.t("slide7.paragraph1","You can send messages to one person or to a group of people. By default all group messages are available to everyone in the group.")),b.addParagraph(a.t("slide7.paragraph2",'If you wanted to send the message privately to all the recipients, uncheck the "This is a group conversation" checkbox.'))}),c.addSlide(a.t("titles.slide8","Slide 8"),function(b){return b.addImage("/images/conversations/intro/image8.png","screenshot"),b.addParagraph(a.t("slide8.paragraph1","You can select one or more messages by clicking the checkbox on the right hand side.")),b.addParagraph(a.t("slide8.paragraph2","Once selected, you can forward them to someone else, or delete them."))}),c.addSlide(a.t("titles.slide9","Slide 9"),function(b){return b.addImage("/images/conversations/intro/image9.png","screenshot","http://www.youtube.com/watch?v=NWqIaEyVWZM"),b.addParagraph(a.t("slide9.paragraph1","We think you'll find Conversations simple and easy to use.")),b.addParagraph(a.t("slide9.paragraph2","Check out this short introduction video to see Conversations in action.")),b.addParagraph(a.t("slide9.paragraph3","Your old messages have been organized into Conversations for you. So what are you waiting for? Get started!"))}),c.dom.bind("dialogclose",function(){return $.ajaxJSON("/conversations/watched_intro","POST",{})}),c.start()}})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1};define("compiled/messages",["i18n","jquery","str/htmlEscape","compiled/conversations_intro","jquery.ajaxJSON","jquery.instructure_date_and_time","jquery.instructure_forms","jquery.instructure_jquery_patches","jquery.instructure_misc_helpers","jquery.instructure_misc_plugins","jquery.loadingImg","jquery.rails_flash_notifications","media_comments","vendor/jquery.ba-hashchange","vendor/jquery.ba-tinypubsub","vendor/jquery.cookie","vendor/jquery.elastic","vendor/jquery.pageless","vendor/jquery.placeholder","vendor/jquery.scrollTo","jqueryui/mouse","jqueryui/position"],function(c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q;return h=[],g=[],l=[],k=[],i=[],m=null,j=null,q={},n={},o=function(){function c(b,c){var e,f;this.node=b,this.options=c,this.node.data("token_input",this),this.fake_input=d("<div />").css("font-family",this.node.css("font-family")).insertAfter(this.node).addClass("token_input").click(a(function(){return this.input.focus()},this)),this.node_name=this.node.attr("name"),this.node.removeAttr("name").hide().change(a(function(){return this.tokens.html(""),typeof this.change=="function"?this.change(this.token_values()):void 0},this)),this.added=this.options.added,this.placeholder=d("<span />"),this.placeholder.text(this.options.placeholder),this.options.placeholder&&this.placeholder.appendTo(this.fake_input),this.tokens=d("<ul />").appendTo(this.fake_input),this.tokens.click(a(function(a){var b,c;if(c=d(a.target).closest("li")){b=d(a.target).closest("a");if(b.length)return c.remove(),typeof this.change=="function"?this.change(this.token_values()):void 0}},this)),this.tokens.maxTokenWidth=a(function(){return parseInt(this.tokens.css("width").replace("px",""))-150+"px"},this),this.tokens.resizeTokens=a(function(a){return a.find("div.ellipsis").css("max-width",this.tokens.maxTokenWidth())},this),d(window).resize(a(function(){return this.tokens.resizeTokens(this.tokens)},this)),this.input=d("<input />").appendTo(this.fake_input).css("width","20px").css("font-size",this.fake_input.css("font-size")).autoGrowInput({comfortZone:20}).focus(a(function(){return this.placeholder.hide(),this.active=!0,this.fake_input.addClass("active")},this)).blur(a(function(){return this.active=!1,setTimeout(a(function(){var a;if(!this.active)return this.fake_input.removeClass("active"),this.placeholder.showIf(this.val()===""&&!this.tokens.find("li").length),(a=this.selector)!=null?typeof a.blur=="function"?a.blur():void 0:void 0},this),50)},this)).keydown(a(function(a){return this.input_keydown(a)},this)).keyup(a(function(a){return this.input_keyup(a)},this));if(this.options.selector){e=(f=this.options.selector.type)!=null?f:p,delete this.options.selector.type;if(this.browser=this.options.selector.browser)delete this.options.selector.browser,d('<a class="browser">browse</a>').click(a(function(){if(this.selector.browse(this.browser.data))return this.fake_input.addClass("browse")},this)).prependTo(this.fake_input);this.selector=new e(this,this.node.attr("finder_url"),this.options.selector)}this.base_exclude=[],this.resize()}return c.prototype.resize=function(){return this.fake_input.css("width",this.node.css("width"))},c.prototype.add_token=function(a){var b,c,e,f,g,h,i,j,k,l;return i=(j=a!=null?a.value:void 0)!=null?j:this.val(),f="token_"+i,e=this.tokens.find("#"+f),g=e.length===0,g&&(e=d("<li />"),h=(k=a!=null?a.text:void 0)!=null?k:this.val(),e.attr("id",f),c=d("<div />").addClass("ellipsis"),c.attr("title",h),c.text(h),e.append(c),b=d("<a />"),e.append(b),e.append(d("<input />").attr("type","hidden").attr("name",this.node_name+"[]").val(i)),this.tokens.resizeTokens(e),this.tokens.append(e)),(a!=null?!a.no_clear:!void 0)&&this.val(""),this.placeholder.hide(),a&&typeof this.added=="function"&&this.added(a.data,e,g),typeof this.change=="function"&&this.change(this.token_values()),(l=this.selector)!=null?l.reposition():void 0},c.prototype.has_token=function(a){var b;return this.tokens.find("#token_"+((b=a!=null?a.value:void 0)!=null?b:a)).length>0},c.prototype.remove_token=function(a){var b,c,d;return b="token_"+((c=a!=null?a.value:void 0)!=null?c:a),this.tokens.find("#"+b).remove(),typeof this.change=="function"&&this.change(this.token_values()),(d=this.selector)!=null?d.reposition():void 0},c.prototype.remove_last_token=function(a){var b;return this.tokens.find("li").last().remove(),typeof this.change=="function"&&this.change(this.token_values()),(b=this.selector)!=null?b.reposition():void 0},c.prototype.input_keydown=function(a){var c,d,e;this.keyup_action=!1;if(this.selector){if((c=this.selector)!=null?c.capture_keydown(a):void 0)return a.preventDefault(),!1;this.fake_input.removeClass("browse")}else if((d=(e=a.which,b.call(this.delimiters,e)>=0))!=null?d:[])return this.keyup_action=this.add_token,a.preventDefault(),!1;return!0},c.prototype.token_values=function(){var a,b,c,d,e;d=this.tokens.find("input"),e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.value);return e},c.prototype.input_keyup=function(a){return typeof this.keyup_action=="function"?this.keyup_action():void 0},c.prototype.bottom_offset=function(){var a;return a=this.fake_input.offset(),a.top+=this.fake_input.height()+2,a},c.prototype.focus=function(){return this.input.focus()},c.prototype.val=function(a){var b;if(a==null)return this.input.val();if(a!==this.input.val())return this.input.val(a).change(),(b=this.selector)!=null?b.reposition():void 0},c.prototype.caret=function(){var a,b,c,d;return this.input[0].selectionStart!=null?(c=this.input[0].selectionStart,a=this.input[0].selectionEnd):(d=this.val(),b=document.selection.createRange().duplicate(),b.moveEnd("character",d.length),c=b.text===""?d.length:d.lastIndexOf(b.text),b=document.selection.createRange().duplicate(),b.moveStart("character",-d.length),a=b.text.length),c===a?c:-1},c.prototype.selector_closed=function(){return this.fake_input.removeClass("browse")},c}(),d.fn.tokenInput=function(a){return this.each(function(){return new o(d(this),d.extend(!0,{},a))})},p=function(){function b(b,c,e){this.input=b,this.url=c,this.options=e!=null?e:{},this.stack=[],this.query_cache={},this.container=d("<div />").addClass("autocomplete_menu"),this.menu=d("<div />").append(this.list=this.new_list()),this.container.append(d("<div />").append(this.menu)),this.container.css("top",0).css("left",0),this.mode="input",d("body").append(this.container),this.reposition=a(function(){var a;return a=this.input.bottom_offset(),this.container.css("top",a.top),this.container.css("left",a.left)},this),d(window).resize(this.reposition),this.close()}return b.prototype.browse=function(a){if(!this.ui_locked)return this.input.val(""),this.close(),this.fetch_list({data:a}),!0},b.prototype.new_list=function(){var b;return b=d('<div class="list"><ul class="heading"></ul><ul></ul></div>'),b.find("ul").mousemove(a(function(a){var b;if(this.ui_locked)return;return b=d(a.target).closest("li"),b.hasClass("selectable")||(b=null),this.select(b)},this)).mousedown(a(function(b){return setTimeout(a(function(){return this.input.focus()},this),0)},this)).click(a(function(a){var b;if(this.ui_locked)return;return b=d(a.target).closest("li"),b.hasClass("selectable")||(b=null),this.select(b),this.selection&&(d(a.target).closest("a.expand").length?this.selection_expanded()?this.collapse():this.expand_selection():this.selection_toggleable()&&d(a.target).closest("a.toggle").length?this.toggle_selection():this.selection_expanded()?this.collapse():this.selection_expandable()?this.expand_selection():(this.toggle_selection(!0),this.clear(),this.close())),this.input.focus()},this)),b.body=b.find("ul").last(),b},b.prototype.capture_keydown=function(a){var b,c;if(this.ui_locked)return!0;switch((b=(c=a.originalEvent)!=null?c.keyIdentifier:void 0)!=null?b:a.which){case"Backspace":case"U+0008":case 8:if(this.input.val()==="")return this.list_expanded()?this.collapse():this.menu.is(":visible")?this.close():this.input.remove_last_token(),!0;break;case"Tab":case"U+0009":case 9:this.selection&&(this.selection_toggleable()||!this.selection_expandable())&&this.toggle_selection(!0),this.clear(),this.close();if(this.selection)return!0;break;case"Enter":case 13:if(this.selection_expanded())return this.collapse(),!0;if(this.selection_expandable()&&!this.selection_toggleable())return this.expand_selection(),!0;return this.selection&&(this.toggle_selection(!0),this.clear()),this.close(),!0;case"Shift":case 16:return!1;case"Esc":case"U+001B":case 27:return this.menu.is(":visible")?(this.close(),!0):!1;case"U+0020":case 32:if(this.selection_toggleable()&&this.mode==="menu")return this.toggle_selection(),!0;break;case"Left":case 37:if(this.list_expanded()&&this.input.caret()===0)return this.selection_expanded()||this.input.val()===""?this.collapse():this.select(this.list.find("li").first()),!0;break;case"Up":case 38:return this.select_prev(),!0;case"Right":case 39:if(this.input.caret()===this.input.val().length&&this.expand_selection())return!0;break;case"Down":case 40:return this.select_next(),!0;case"U+002B":case 187:case 107:if(this.selection_toggleable()&&this.mode==="menu")return this.toggle_selection(!0),!0;break;case"U+002D":case 189:case 109:if(this.selection_toggleable()&&this.mode==="menu")return this.toggle_selection(!1),!0}return this.mode="input",this.fetch_list(),!1},b.prototype.fetch_list=function(b,c){return b==null&&(b={}),this.ui_locked=c!=null?c:!1,this.timeout!=null&&clearTimeout(this.timeout),this.timeout=setTimeout(a(function(){var c,e,f;delete this.timeout,c=this.prepare_post((f=b.data)!=null?f:{}),e=JSON.stringify(c);if(c.search===""&&!this.list_expanded()&&!b.data){this.ui_locked=!1,this.close();return}if(e===this.last_applied_query){this.ui_locked=!1;return}if(this.query_cache[e]){this.last_applied_query=e,this.last_search=c.search,this.clear_loading(),this.render_list(this.query_cache[e],b,c);return}return this.set_loading(),d.ajaxJSON(this.url,"POST",d.extend({},c),a(function(a){var d;this.query_cache[e]=a,this.clear_loading();if(JSON.stringify(this.prepare_post((d=b.data)!=null?d:{}))!==e)return this.ui_locked=!1;this.last_applied_query=e,this.last_search=c.search;if(this.menu.is(":visible"))return this.render_list(a,b,c)},this),a(function(a){return this.ui_locked=!1,this.clear_loading()},this))},this),100)},b.prototype.add_by_user_id=function(b,c){return this.set_loading(),d.ajaxJSON(this.url,"POST",{user_id:b,from_conversation_id:c},a(function(a){var b;this.clear_loading(),this.close(),b=a[0];if(b)return this.input.add_token({value:b.id,text:b.name,data:b})},this),a(function(a){return this.clear_loading(),this.close()},this))},b.prototype.open=function(){return this.container.show(),this.reposition()},b.prototype.close=function(){var a,b,c,d,e,f,g,h;this.ui_locked=!1,this.container.hide(),delete this.last_applied_query,g=this.stack;for(c=0,f=g.length;c<f;c++)h=g[c],b=h[0],a=h[1],d=h[2],e=h[3],this.list.remove(),this.list=a.css("height","auto");return this.list.find("ul").html(""),this.stack=[],this.menu.css("left",0),this.select(null),this.input.selector_closed()},b.prototype.clear=function(){return this.input.val("")},b.prototype.blur=function(){return this.close()},b.prototype.list_expanded=function(){return this.stack.length?!0:!1},b.prototype.selection_expanded=function(){var a,b;return(a=(b=this.selection)!=null?b.hasClass("expanded"):void 0)!=null?a:!1},b.prototype.selection_expandable=function(){var a,b;return(a=(b=this.selection)!=null?b.hasClass("expandable"):void 0)!=null?a:!1},b.prototype.selection_toggleable=function(a){var b;return a==null&&(a=this.selection),((b=a!=null?a.hasClass("toggleable"):void 0)!=null?b:!1)&&!this.selection_expanded()},b.prototype.expand_selection=function(){return!this.selection_expandable()||!!this.selection_expanded()?!1:(this.stack.push([this.selection,this.list,this.last_applied_query,this.last_search]),this.clear(),this.menu.css("width",(this.stack.length+1)*100+"%"),this.fetch_list({expand:!0},!0))},b.prototype.collapse=function(){var b,c,d;return this.list_expanded()?(d=this.stack.pop(),c=d[0],b=d[1],this.last_applied_query=d[2],this.last_search=d[3],this.ui_locked=!0,b.css("height","auto"),this.menu.animate({left:"+="+this.menu.parent().css("width")},"fast",a(function(){return this.input.val(this.last_search),this.list.remove(),this.list=b,this.select(c),this.ui_locked=!1},this))):!1},b.prototype.toggle_selection=function(a,b,c){var d,e;b==null&&(b=this.selection),c==null&&(c=!1);if(a==null&&!this.selection_toggleable(b))return!1;d=b.data("id"),a==null&&(a=!b.hasClass("on")),a?(this.selection_toggleable(b)&&!c&&b.addClass("on"),this.input.add_token({value:d,text:(e=b.data("text"))!=null?e:b.text(),no_clear:!0,data:b.data("user_data")})):(c||b.removeClass("on"),this.input.remove_token({value:d}));if(!c)return this.update_select_all(b)},b.prototype.update_select_all=function(b,c){var e,f,g,h,i,j;c==null&&(c=0),j=b.data("user_data").select_all,e=c?this.stack[this.stack.length-c][1]:this.list,i=e.select_all;if(!i)return;f=e.body.find("li.toggleable").not(i),j?i.hasClass("on")?f.addClass("on").each(a(function(a,b){return this.toggle_selection(!1,d(b),!0)},this)):f.removeClass("on").each(a(function(a,b){return this.toggle_selection(!1,d(b),!0)},this)):(g=f.filter(".on"),g.length<f.length&&i.hasClass("on")?(i.removeClass("on"),this.toggle_selection(!1,i,!0),g.each(a(function(a,b){return this.toggle_selection(!0,d(b),!0)},this))):g.length===f.length&&!i.hasClass("on")&&(i.addClass("on"),this.toggle_selection(!0,i,!0),g.each(a(function(a,b){return this.toggle_selection(!1,d(b),!0)},this))));if(c<this.stack.length){c++,h=this.stack[this.stack.length-c][0];if(this.selection_toggleable(h))return i.hasClass("on")?h.addClass("on"):h.removeClass("on"),this.update_select_all(h,c)}},b.prototype.select=function(a,b){var c,d;b==null&&(b=!1);if((a!=null?a[0]:void 0)===((c=this.selection)!=null?c[0]:void 0))return;(d=this.selection)!=null&&d.removeClass("active"),this.selection=(a!=null?a.length:void 0)?(a.addClass("active"),a.scrollIntoView({ignore:{border:!0}}),a):null;if(!b)return this.mode=a?"menu":"input"},b.prototype.select_next=function(a){var b;a==null&&(a=!1),this.select(this.selection?this.selection.next().length?this.selection.next():this.selection.parent("ul").next().length?this.selection.parent("ul").next().find("li").first():null:this.list.find("li:first"),a);if((b=this.selection)!=null?b.hasClass("message"):void 0)return this.select_next(a)},b.prototype.select_prev=function(){var a,b;this.select(this.selection?((a=this.selection)!=null?a.prev().length:void 0)?this.selection.prev():this.selection.parent("ul").prev().length?this.selection.parent("ul").prev().find("li").last():null:this.list.find("li:last"));if((b=this.selection)!=null?b.hasClass("message"):void 0)return this.select_prev()},b.prototype.populate_row=function(a,b,c){c==null&&(c={}),this.options.populator?this.options.populator(a,b,c):(a.data("id",b.text),a.text(b.text)),c.first&&a.addClass("first");if(c.last)return a.addClass("last")},b.prototype.set_loading=function(){return this.menu.is(":visible")||(this.open(),this.list.find("ul").last().append(d('<li class="message first last"></li>'))),this.list.find("li").first().loadingImage()},b.prototype.clear_loading=function(){return this.list.find("li").first().loadingImage("remove")},b.prototype.render_list=function(b,c,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;c==null&&(c={}),e==null&&(e={}),this.open(),c.expand?i=this.new_list():i=this.list,i.select_all=null,this.selection=null,k=i.find("ul"),k.html(""),g=k.first(),f=k.last();if(b.length){m=this.stack.length?this.stack[this.stack.length-1][0]:null,b.prepared||(typeof (o=this.options).preparer=="function"&&o.preparer(e,b,m),b.prepared=!0);for(l=0,q=b.length;l<q;l++)n=b[l],h=d("<li />").addClass("selectable"),this.populate_row(h,n,{level:this.stack.length,first:l===0,last:l===b.length-1,parent:m}),n.select_all&&(i.select_all=h),h.hasClass("toggleable")&&this.input.has_token(h.data("id"))&&h.addClass("on"),f.append(h);(((r=i.select_all)!=null?typeof r.hasClass=="function"?r.hasClass("on"):void 0:void 0)||this.stack.length&&(typeof (p=this.stack[this.stack.length-1][0]).hasClass=="function"?p.hasClass("on"):void 0))&&i.body.find("li.toggleable").addClass("on")}else j=d('<li class="message first last"></li>'),j.text((s=(t=this.options.messages)!=null?t.no_results:void 0)!=null?s:""),f.append(j);return this.list_expanded()?(h=this.stack[this.stack.length-1][0].clone(),h.addClass("expanded").removeClass("active first last"),g.append(h).show()):g.hide(),c.expand?(i.insertAfter(this.list),this.menu.animate({left:"-="+this.menu.parent().css("width")},"fast",a(function(){return this.list.animate({height:"1px"},"fast",a(function(){return this.ui_locked=!1},this)),this.list=i,this.select_next(!0)},this))):(c.loading||this.select_next(!0),this.ui_locked=!1)},b.prototype.prepare_post=function(a){var b,c,e,f;return b=d.extend(a,{search:this.input.val()},(e=this.options.base_data)!=null?e:{}),b.exclude=this.input.base_exclude.concat(this.stack.length?[]:this.input.token_values()),this.list_expanded()&&(b.context=this.stack[this.stack.length-1][0].data("id")),(f=b.per_page)==null&&(b.per_page=typeof (c=this.options).limiter=="function"?c.limiter({level:this.stack.length}):void 0),b},b}(),d.fn.scrollIntoView=function(a){var b,c,e,f,g,h;a==null&&(a={}),b=this.offsetParent(),e=b.scrollTop(),c=e+b.height(),g=this[0].offsetTop,f=g+d(this[0]).outerHeight();if((h=a.ignore)!=null?h.border:void 0)g+=parseInt(d(this[0]).css("border-top-width").replace("px","")),f-=parseInt(d(this[0]).css("border-bottom-width").replace("px",""));if(g<e)return b.scrollTop(g);if(f>c)return b.scrollTop(f-b.height())},c.scoped("conversations",function(a){var c,o,p,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R;return O=function(){var b;return b=m==null,i.find("#recipient_info").showIf(b),i.find("#group_conversation_info").hide(),d("#action_compose_message").toggleClass("active",b),b?(i.find(".audience").html(a.t("headings.new_message","New Message")),i.addClass("new"),i.find("#action_add_recipients").hide(),i.attr({action:"/conversations"})):(i.find(".audience").html(m.find(".audience").html()),i.removeClass("new"),i.find("#action_add_recipients").showIf(!m.hasClass("private")),i.attr({action:m.find("a.details_link").attr("add_url")})),I(),i.find("#user_note_info").hide().find("input").attr("checked",!1),i.show().find(":input:visible:first").focus()},I=function(){return m!=null&&i.find(".audience").html(m.find(".audience").html()),i.find("input[name!=authenticity_token], textarea").val("").change(),i.find(".attachment:visible").remove(),i.find(".media_comment").hide(),i.find("#action_media_comment").show(),B()},F=function(a){var b,c,d,e,f,g,h,i;a==null&&(a=window.location.search.substr(1)),b={},h=a.split(/\&/);for(f=0,g=h.length;f<g;f++)d=h[f],i=d.split(/\=/,2),c=i[0],e=i[1],b[decodeURIComponent(c)]=decodeURIComponent(e);return b},C=function(a){return m&&m.attr("id")===(a!=null?a.attr("id"):void 0)},K=function(a,b){return d.ajaxJSON("/conversations/"+a,"GET",{},function(e){return c(e.conversation,!0),d("#conversation_"+a).hide(),J(d("#conversation_"+a),d.extend(b,{data:e}))})},J=function(a,b){var c,e;b==null&&(b={}),Q(!1);if(C(a)){m.removeClass("inactive"),k.find("li.selected").removeClass("selected");return}k.removeClass("private").hide().html(""),(a!=null?a.hasClass("private"):void 0)&&k.addClass("private"),m&&(m.removeClass("selected inactive"),n.scope==="unread"&&m.fadeOut("fast",function(){return d(this).remove(),d("#no_messages").showIf(!g.find("li").length)}),m=null),a&&(m=a.addClass("selected")),m||d("#action_compose_message").length?(O(),b.message&&i.find("#body").val(b.message)):i.parent().hide();if(m)m.scrollIntoView();else{b.user_id&&(d("#from_conversation_id").val(b.from_conversation_id),d("#recipients").data("token_input").selector.add_by_user_id(b.user_id,b.from_conversation_id));return}return i.loadingImage(),c=m,e=function(a){var b,e,f,g,h,j,o,p,q,t;if(!C(c))return;p=a.participants;for(j=0,o=p.length;j<o;j++){h=p[j];if((q=n.user_cache[h.id])!=null?!q.avatar_url:!void 0)n.user_cache[h.id]=h,h.html_name=y(h)}a["private"]&&(h=function(){var b,c,d,e;d=a.participants,e=[];for(b=0,c=d.length;b<c;b++)h=d[b],h.id!==n.user_id&&e.push(h);return e}()[0]&&u(h))&&i.find("#user_note_info").show(),B(),l.show(),b=e=0,f=a.messages[0],g=a.submissions[0];while(f||g)f&&(!g||d.parseFromISO(f.created_at).datetime>d.parseFromISO((t=g.submission_comments[g.submission_comments.length-1])!=null?t.created_at:void 0).datetime)?(k.append(r(f)),f=a.messages[++b]):(k.append(s(g)),g=a.submissions[++e]);i.loadingImage("remove"),k.hide().slideDown("fast");if(m.hasClass("unread"))return L(m,"read")},b.data?e(b.data):d.ajaxJSON(m.find("a.details_link").attr("href"),"GET",{},function(a){return e(a)},function(){return i.loadingImage("remove")})},n.context_list=function(a,b){var c,e,f,g,h,i;return b==null&&(b=2),i=function(){var b,d;b=a.courses,d=[];for(e in b)h=b[e],(c=this.contexts.courses[e])&&d.push(c.name);return d}.call(this).concat(function(){var b,c;b=a.groups,c=[];for(g in b)h=b[g],(f=this.contexts.groups[g])&&c.push(f.name);return c}.call(this)),d.toSentence(i.sort(function(a,b){return a=a.toLowerCase(),b=b.toLowerCase(),a<b?-1:a>b?1:0}).slice(0,b))},y=function(a,b){var c,d;return b==null&&(b={courses:a.common_courses,groups:a.common_groups}),e(a.name)+(((c=b.courses)!=null?c.length:void 0)||((d=b.groups)!=null?d.length:void 0)?" <em>"+e(n.context_list(b))+"</em>":"")},u=function(a){var c,d,e,f;if(!n.notes_enabled)return!1;if(a.can_add_notes)return!0;e=a.common_courses;for(c in e){d=e[c];if(b.call(d,"StudentEnrollment")>=0&&(n.can_add_notes_for_account||((f=n.contexts.courses[c])!=null?f.can_add_notes:void 0)))return!0}return!1},w=function(b){var c,d,f,g,h,i,j,k,l,m,n;f="LINK_PLACEHOLDER",g=/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))|(LINK_PLACEHOLDER)/gi,h=[],i=[],b=b.replace(g,function(a,b){var c;return i.push(a===f?f:(c=a,c.slice(0,4)==="www"?c="http://"+c:void 0,c=encodeURI(c).replace(/'/g,"%27"),h.push(c),"<a href='"+e(c)+"'>"+e(a)+"</a>")),f}),b=e(b),b=b.replace(new RegExp(f,"g"),function(a,b){return i.shift()}),b=b.replace(/\n/g,"<br />\n"),j=[],k=[],m=0,l=function(b){return m+=1,"<div class='quoted_text_holder'>          <a href='#' class='show_quoted_text_link'>"+a.t("quoted_text_toggle","show quoted text")+"</a>          <div class='quoted_text' style='display: none;'>            "+b.join("\n")+"          </div>        </div>"},n=b.split("\n");for(c in n)d=n[c],d.match(/^(&gt;|>)/)?k.push(d):(k.length&&j.push(l(k)),k=[],j.push(d));return k.length&&j.push(l(k)),b=j.join("\n")},r=function(b){var c,f,g,h,i,j,k,l,q,s,t,u,v,x,z,A,B,C,D,E,F;g=d("#message_blank").clone(!0).attr("id","message_"+b.id),g.data("id",b.id),g.addClass(b.generated?"generated":b.author_id===n.user_id?"self":"other"),s=n.user_cache[b.author_id],(k=s!=null?s.avatar_url:void 0)&&g.prepend(d("<img />").attr("src",k).addClass("avatar")),s&&(A=s.html_name)==null&&(s.html_name=y(s)),t=(B=s!=null?s.name:void 0)!=null?B:a.t("unknown_user","Unknown user"),g.find(".audience").html((s!=null?s.html_name:void 0)||e(t)),g.find("span.date").text(d.parseFromISO(b.created_at).datetime_formatted),g.find("p").html(w(b.body)),g.find("a.show_quoted_text_link").click(function(a){var b;b=d(this).parents(".quoted_text_holder").children(".quoted_text");if(b.length)return a.stopPropagation(),a.preventDefault(),b.show(),d(this).hide()}),h=g.find("a.send_private_message"),l=d.replaceTags(h.attr("href"),{user_id:b.author_id,user_name:encodeURIComponent(t),from_conversation_id:m.data("id")}),h.attr("href",l).click(function(a){return a.stopPropagation()});if((C=b.forwarded_messages)!=null?C.length:void 0){i=d('<ul class="messages"></ul>'),D=b.forwarded_messages;for(u=0,x=D.length;u<x;u++)q=D[u],i.append(r(q));g.append(i)}i=g.find("ul.message_attachments").detach(),f=i.find(".media_object_blank").detach(),c=i.find(".attachment_blank").detach();if(b.media_comment!=null||((E=b.attachments)!=null?E.length:void 0)){g.append(i),b.media_comment!=null&&i.append(p(f,b.media_comment));if(b.attachments!=null){F=b.attachments;for(v=0,z=F.length;v<z;v++)j=F[v],i.append(o(c,j))}}return g},p=function(a,b){var c;return c=a.clone(!0).attr("id","media_comment_"+b.media_id),c.find("span.title").html(e(b.display_name)),c.find("span.media_comment_id").html(e(b.media_id)),c},o=function(a,b){var c,d;return c=a.clone(!0).attr("id","attachment_"+b.id),c.data("id",b.id),c.find("span.title").html(e(b.display_name)),d=c.find("a"),d.attr("href",b.url),d.click(function(a){return a.stopPropagation()}),c},P=function(a){return"submission_"+a.assignment_id+"_"+a.user_id},s=function(b){var c,f,g,h,i,j,k,l,m,o,p,q,r,s,u,v,w,x;i=d("#submission_blank").clone(!0).attr("id",P(b)),i.data("id",P(b)),j=i.find("ul"),f=j.find("li.header"),l=d.replaceTags(f.find("a").attr("href"),{course_id:b.assignment.course_id,assignment_id:b.assignment_id,id:b.user_id}),f.find("a").attr("href",l),r=n.user_cache[b.user_id],r&&(u=r.html_name)==null&&(r.html_name=y(r)),s=(v=r!=null?r.name:void 0)!=null?v:a.t("unknown_user","Unknown user"),f.find(".title").html(e(b.assignment.name)),b.submitted_at&&f.find("span.date").text(d.parseFromISO(b.submitted_at).datetime_formatted),f.find(".audience").html((r!=null?r.html_name:void 0)||e(s)),b.score&&b.assignment.points_possible?q=""+b.score+" / "+b.assignment.points_possible:q=(w=b.score)!=null?w:a.t("not_scored","no score"),f.find(".score").html(q),c=j.find(".comment").detach(),o=0,p=4;for(m=x=b.submission_comments.length-1;m>=0;m+=-1){k=b.submission_comments[m];if(o<10)o++,k=t(c,k),o>p&&k.hide(),j.append(k);else break}return h=j.find(".more").detach(),o>p&&(g=h.clone(!0),g.find(".hidden").text(o-p),g.attr("title",e(a.t("titles.expand_inline","Show more comments"))),g.click(function(){var a;return a=d(this).closest(".submission"),a.find(".more:hidden").show(),d(this).hide(),a.find(".comment:hidden").slideDown("fast"),B(),!1}),j.append(g)),b.submission_comments.length>o&&(h.find("a").attr("href",l).attr("target","_blank"),h.find(".hidden").text(b.submission_comments.length-o),h.attr("title",e(a.t("titles.view_submission","Open submission in new window."))),b.submission_comments.length>p&&h.hide(),j.append(h)),i},t=function(b,c){var f,g,h,i,j,k;return f=b.clone(!0),h=n.user_cache[c.author_id],(g=h!=null?h.avatar_url:void 0)&&f.prepend(d("<img />").attr("src",g).addClass("avatar")),h&&(j=h.html_name)==null&&(h.html_name=y(h)),i=(k=h!=null?h.name:void 0)!=null?k:a.t("unknown_user","Unknown user"),f.find(".audience").html((h!=null?h.html_name:void 0)||e(i)),f.find("span.date").text(d.parseFromISO(c.created_at).datetime_formatted),f.find("p").html(e(c.comment).replace(/\n/g,"<br />")),f},A=function(a,b){return d.replaceTags(a.attr("href"),"id",b.data("id"))},z=function(a,b){var c,e,f,g,h;c=(f=b.loading_node)!=null?f:a.closest("ul.conversations li"),c.length||(c=d("#conversation_actions").data("selected_conversation")),e={loading_node:c,url:A(a,c),method:"POST",data:{}},b=d.extend(e,b);if((g=typeof b.before==="function"?b.before(b.loading_node,b):void 0)!=null?!g:!1)return;return(h=b.loading_node)!=null&&h.loadingImage(),d.ajaxJSON(b.url,b.method,b.data,function(a){var c;return(c=b.loading_node)!=null&&c.loadingImage("remove"),typeof b.success=="function"?b.success(b.loading_node,a):void 0},function(a){var c;return(c=b.loading_node)!=null&&c.loadingImage("remove"),typeof b.error=="function"?b.error(b.loading_node,a):void 0})},c=function(a,b){var c;return d("#no_messages").hide(),c=d("#conversation_"+a.id),c.length?c.show():c=d("#conversation_blank").clone(!0).attr("id","conversation_"+a.id),c.data("id",a.id),a.avatar_url&&c.prepend(d("<img />").attr("src",a.avatar_url).addClass("avatar")),c[b?"appendTo":"prependTo"](g).click(function(a){return a.preventDefault(),M("#/conversations/"+d(this).data("id"))}),R(c,a,null),b||c.hide().slideDown("fast"),g.append(d("#conversations_loader")),c},x=function(b,c){var f,g,h,i;return c==null&&(c=2),f=b.audience,f.length===0?"<span>"+e(a.t("notes_to_self","Monologue"))+"</span>":(g="<em>"+e(n.context_list(b.audience_contexts))+"</em>",f.length===1?"<span>"+e(n.user_cache[f[0]].name)+"</span> "+g:(f.length>c&&(f=f.slice(0,c).concat([f.slice(c,f.length)])),d.toSentence(function(){var b,c,d;d=[];for(b=0,c=f.length;b<c;b++)i=f[b],d.push(typeof i=="number"?"<span>"+e(n.user_cache[i].name)+"</span>":"<span class='others'>\n  "+e(a.t("other_recipients","other",{count:i.length}))+"\n  <span>\n    <ul>\n      "+function(){var a,b,c;c=[];for(a=0,b=i.length;a<b;a++)h=i[a],c.push("<li>"+e(n.user_cache[h].name)+"</li>");return c}().join("")+"\n    </ul>\n  </span>\n</span>");return d}())+" "+g))},R=function(a,b,c){var e,f,g,h,i,j,k,l,m,o,p;c==null&&(c="slide"),Q(!1),e=a.find("a.details_link"),e.attr("href",d.replaceTags(e.attr("href"),"id",b.id)),e.attr("add_url",d.replaceTags(e.attr("add_url"),"id",b.id));if(b.participants){o=b.participants;for(j=0,l=o.length;j<l;j++)i=o[j],n.user_cache[i.id]||(n.user_cache[i.id]=i)}b.audience&&(a.data("audience",b.audience.concat([n.user_id])),a.find(".audience").html(x(b))),a.find(".actions a").click(function(a){return a.preventDefault(),a.stopImmediatePropagation(),v(),D(d(this))}).focus(function(){return v(),D(d(this))}),b.message_count!=null&&(a.find(".count").text(b.message_count),a.find(".count").showIf(b.message_count>1)),a.find("span.date").text(d.friendlyDatetime(d.parseFromISO(b.last_message_at).datetime)),g=a.data("last_message_at")>b.last_message_at?"down":"up",a.data("last_message_at",b.last_message_at),a.data("label",b.label),f=a.find("p"),f.text(b.last_message);if(b.properties.length){p=b.properties;for(k=0,m=p.length;k<m;k++)h=p[k],a.addClass(h)}b["private"]&&a.addClass("private"),b.label&&a.addClass("labeled").addClass(b.label),b.subscribed||a.addClass("unsubscribed"),L(a,b.workflow_state);if(c)return H(a,g,c)},H=function(a,b,c){var e,f,g;a.show(),g=a.data("last_message_at"),f=a;if(b==="up")while(f.prev()&&f.prev().data("last_message_at")<g)f=f.prev();else while(f.next()&&f.next().data("last_message_at")>g)f=f.next();if(f===a)return;return c==="immediate"?a.detach()[b==="up"?"insertBefore":"insertAfter"](f).scrollIntoView():(e=a.clone().insertAfter(a),a.detach()[b==="up"?"insertBefore":"insertAfter"](f).animate({opacity:"toggle",height:"toggle"},0),e.animate({opacity:"toggle",height:"toggle"},200,function(){return d(this).remove()}),a.animate({opacity:"toggle",height:"toggle"},200,function(){return a.scrollIntoView()}))},G=function(a){var b;return b=C(a),a.fadeOut("fast",function(){d(this).remove(),d("#no_messages").showIf(!g.find("li").length);if(b)return M("")})},L=function(a,b){return a.removeClass("read unread archived").addClass(b)},d("#conversations").delegate(".actions a","blur",function(a){return d(window).one("keyup",function(a){if(a.shiftKey)return v()})}),D=function(a){var b,c,e,f;return e={node:a,container:d("#conversation_actions"),conversation:a.closest("li"),parent:a.parent(),lists:d("#conversation_actions ul"),listElements:d("#conversation_actions li"),focusable:d("a, input, select, textarea"),actions:{markAsRead:d("#action_mark_as_read").parent(),markAsUnread:d("#action_mark_as_unread").parent(),unsubscribe:d("#action_unsubscribe").parent(),subscribe:d("#action_subscribe").parent(),forward:d("#action_forward").parent(),archive:d("#action_archive").parent(),unarchive:d("#action_unarchive").parent(),"delete":d("#action_delete").parent(),deleteAll:d("#action_delete_all").parent()},labels:{group:d("#conversation_actions .label_group"),icon:d("#conversation_actions .label_icon")}},q.activeActionMenu=e.node,e.parent.addClass("selected"),e.container.addClass("selected"),e.conversation.addClass("menu_active"),b=e.container,c=e.conversation,e.container.data("selected_conversation",e.conversation),e.lists.removeClass("first last").hide(),e.listElements.hide(),e.conversation.hasClass("unread")&&e.actions.markAsRead.show(),e.conversation.hasClass("read")&&e.actions.markAsUnread.show(),e.labels.group.show(),e.labels.icon.removeClass("checked"),e.container.find(".label_icon."+(c.data("label")||"none")).addClass("checked"),e.conversation.hasClass("private")?(e.actions.subscribe.hide(),e.actions.unsubscribe.hide()):(e.conversation.hasClass("unsubscribed")||e.actions.unsubscribe.show(),e.conversation.hasClass("unsubscribed")&&e.actions.subscribe.show()),e.actions.forward.show(),e.actions["delete"].show(),e.actions.deleteAll.show(),n.scope==="archived"?e.actions.unarchive.show():e.actions.archive.show(),d(window).one("keydown",function(a){if(a.keyCode!==9||a.shiftKey)return;return e.focusable.one("focus.actions_menu",function(a){return q.nextElement=d(a.target),e.focusable.unbind(".actions_menu"),e.container.find("a:visible:first").focus(),e.container.find("a:visible:first").bind("blur.actions_menu",a,function(){return d(window).one("keyup",function(a){var b;b=e.container.find("a:focus").length;if(!b)return e.container.find("a.visible").unbind(".actions_menu"),q.activeActionMenu.focus()})}),e.container.find("a:visible:last").bind("blur.actions_menu",a,function(){return d(window).one("keyup",function(a){var b;b=e.container.find("a:focus").length;if(!b)return e.container.find("a.visible").unbind(".actions_menu"),q.nextElement.focus(),v()})})})}),e.container.find('li[style*="list-item"]').parent().show(),e.groups=e.container.find('ul[style*="block"]'),e.groups.length&&(e.groups.first().addClass("first"),e.groups.last().addClass("last")),f=e.node.offset(),e.container.css({left:f.left+e.node.width()/2-e.container.offsetParent().offset().left-e.container.width()/2,top:f.top+e.node.height()*.9-e.container.offsetParent().offset().top})},v=function(){return d("#actions .menus > li, #conversation_actions, #conversations .actions").removeClass("selected"),d("#conversations li.menu_active").removeClass("menu_active")},E=function(a){var b,c;v();if(!a.hasClass("disabled"))return b=a.parent("li, span").addClass("selected").find("div"),c=-(b.parent().position().left+b.parent().outerWidth()/2)+6,c<-(b.outerWidth()/2)&&(c=-(b.outerWidth()/2)),b.css("margin-left",c+"px")},B=function(){var a;return a=d(window).height()-d("#header").outerHeight(!0)-(d("#wrapper-container").outerHeight(!0)-d("#wrapper-container").height())-(d("#main").outerHeight(!0)-d("#main").height())-d("#breadcrumbs").outerHeight(!0)-d("#footer").outerHeight(!0),a<425&&(a=425),d("#inbox").height(a),k.height(a-i.outerHeight(!0)),g.height(a-d("#actions").outerHeight(!0))},Q=function(a){return a!=null?(k.find("> li").removeClass("selected"),k.find("> li :checkbox").attr("checked",!1)):a=!!k.find("li.selected").length,a?d("#message_actions").slideDown(100):d("#message_actions").slideUp(100),i[a?"addClass":"removeClass"]("disabled")},N=function(a){return g.removeClass("red orange yellow green blue purple").addClass(a),d.cookie("last_label",a),j=a},M=function(a){if(a!==location.hash)return location.hash=a,d(document).triggerHandler("document_fragment_change",a)},d.extend(window,{MessageInbox:n}),n.init=function(){return d(document).ready(function(){var b,e,o,p,q,s,t,w,x;h=d("#conversations"),g=h.find("ul.conversations"),N((w=d.cookie("last_label"))!=null?w:"red"),l=d("#messages"),k=l.find("ul.messages"),i=d("#create_message_form"),b=d("#add_recipients_form"),e=d("#forward_message_form"),d("#help_crumb").click(function(a){return a.preventDefault(),f()}),d("#create_message_form, #forward_message_form").find("textarea").elastic().keypress(function(a){if(a.which===13&&a.shiftKey)return a.preventDefault(),d(this).closest("form").submit(),!1}),i.submit(function(a){var b;return b=!!i.find("#body").val()&&(i.find("#recipient_info").filter(":visible").length===0||i.find(".token_input li").length>0),b||a.stopImmediatePropagation(),b}),i.formSubmit({fileUpload:function(){return d(this).find(".file_input:visible").length>0},beforeSubmit:function(){return d(this).loadingImage()},success:function(b){var e,f,g,h,i;d(this).loadingImage("remove");if(b.length>1){for(g=0,h=b.length;g<h;g++)f=b[g],e=d("#conversation_"+f.id),e.length&&R(e,f,"immediate");d.flashMessage(a.t("messages_sent","Messages Sent"))}else f=(i=b[0])!=null?i:b,e=d("#conversation_"+f.id),e.length?(C(e)&&r(f.messages[0]).prependTo(k).slideDown("fast"),R(e,f)):(c(f),M("#/conversations/"+f.id)),d.flashMessage(a.t("message_sent","Message Sent"));return I()},error:function(b){return i.find(".token_input").errorBox(a.t("recipient_error","The course or group you have selected has no valid recipients")),d(".error_box").filter(":visible").css("z-index",10),d(this).loadingImage("remove")}}),i.click(function(){return Q(!1)}),b.submit(function(a){var b;return b=!!d(this).find(".token_input li").length,b||a.stopImmediatePropagation(),b}),b.formSubmit({beforeSubmit:function(){return d(this).loadingImage()},success:function(a){return d(this).loadingImage("remove"),r(a.messages[0]).prependTo(k).slideDown("fast"),R(m,a),I(),d(this).dialog("close")},error:function(a){return d(this).loadingImage("remove"),d(this).dialog("close")}}),k.click(function(a){var b;if(!d(a.target).closest("a.instructure_inline_media_comment").length)return b=d(a.target).closest("#messages > ul > li"),!b.hasClass("generated")&&!b.hasClass("submission")&&(m!=null&&m.addClass("inactive"),b.toggleClass("selected"),b.find("> :checkbox").attr("checked",b.hasClass("selected"))),Q()}),d(".menus > li > a").click(function(a){return a.preventDefault(),E(d(this))}).focus(function(){return E(d(this))}),d(document).bind("mousedown",function(a){d(a.target).closest("span.others").find("> span").length||d("span.others > span").hide();if(!d(a.target).closest(".menus > li, #conversation_actions, #conversations .actions").length)return v()}),d("#menu_views").parent().find("li a").click(function(a){return v(),d("#menu_views").text(d(this).text())}),d("#message_actions").find("a").click(function(a){return a.preventDefault()}),d("#conversation_actions").find("li a").click(function(a){return a.preventDefault(),v()}),d(".action_mark_as_read").click(function(a){return a.preventDefault(),a.stopImmediatePropagation(),z(d(this),{method:"PUT",before:function(a){return n.scope!=="unread"&&L(a,"read"),!0},success:function(a){if(n.scope==="unread")return G(a)},error:function(a){if(n.scope!=="unread")return L(a("unread"))}})}),d(".action_mark_as_unread").click(function(a){return a.preventDefault(),a.stopImmediatePropagation(),z(d(this),{method:"PUT",before:function(a){return L(a,"unread")},error:function(a){return L(a,"read")}})}),d(".action_remove_label").click(function(a){var b;return a.preventDefault(),a.stopImmediatePropagation(),b=null,z(d(this),{method:"PUT",before:function(a){return b=a.data("label"),b&&a.removeClass("labeled "+b),b},success:function(a,b){R(a,b);if(n.scope==="labeled")return G(a)},error:function(a){return a.addClass("labeled "+b)}})}),d(".action_add_label").click(function(a){var b,c;return a.preventDefault(),a.stopImmediatePropagation(),c=null,b=null,z(d(this),{method:"PUT",before:function(a,d){return b=a.data("label"),c=d.url.match(/%5Blabel%5D=(.*)/)[1],c==="last"&&(c=j,d.url=d.url.replace(/%5Blabel%5D=last/,"%5Blabel%5D="+c)),a.removeClass("red orange yellow green blue purple").addClass("labeled").addClass(c),c!==b},success:function(a,b){R(a,b),N(c);if(n.label_scope&&n.label_scope!==c)return G(a)},error:function(a){a.removeClass("labeled "+c);if(b)return a.addClass("labeled "+b)}})}),d("#action_add_recipients").click(function(c){return c.preventDefault(),b.attr("action",A(d(this),m)).dialog("close").dialog({width:420,title:a.t("title.add_recipients","Add Recipients"),buttons:[{text:a.t("buttons.add_people","Add People"),click:function(){return d(this).submit()}},{text:a.t("#buttons.cancel","Cancel"),click:function(){return d(this).dialog("close")}}],open:function(){var a;return a=d("#add_recipients").data("token_input"),a.base_exclude=m.data("audience"),d(this).find("input[name!=authenticity_token]").val("").change()},close:function(){return d("#add_recipients").data("token_input").input.blur()}})}),d("#action_subscribe").click(function(){return z(d(this),{method:"PUT",data:{subscribed:1},success:function(a){return a.removeClass("unsubscribed")}})}),d("#action_unsubscribe").click(function(){return z(d(this),{method:"PUT",data:{subscribed:0},success:function(a){return a.addClass("unsubscribed")}})}),d("#action_archive, #action_unarchive").click(function(){return z(d(this),{method:"PUT",success:G})}),d("#action_delete_all").click(function(){if(confirm(a.t("confirm.delete_conversation","Are you sure you want to delete your copy of this conversation? This action cannot be undone.")))return z(d(this),{method:"DELETE",success:G})}),d("#action_delete").click(function(){var b,c;b=k.find(".selected"),c=b.length>1?a.t("confirm.delete_messages","Are you sure you want to delete your copy of these messages? This action cannot be undone."):a.t("confirm.delete_message","Are you sure you want to delete your copy of this message? This action cannot be undone.");if(confirm(c))return b.fadeOut("fast"),z(d(this),{loading_node:m,data:{remove:function(){var a,d,e;e=[];for(a=0,d=b.length;a<d;a++)c=b[a],e.push(parseInt(c.id.replace(/message_/,"")));return e}()},success:function(a,c){return k.find("> li").not(".selected, .generated, .submission").length?(b.remove(),R(a,c)):G(a)},error:function(){return b.show()}})}),d("#action_forward").click(function(){var b;return e.find("input[name!=authenticity_token], textarea").val("").change(),b=e.find("ul.messages").first(),b.html(""),b.html(k.find("> li.selected").clone(!0).removeAttr("id").removeClass("self")),b.find("> li").removeClass("selected odd").find("> :checkbox").attr("checked",!0).attr("name","forwarded_message_ids[]").val(function(){return d(this).closest("li").data("id")}),b.find("> li").last().addClass("last"),e.css("max-height",d(window).height()-300+"px").dialog("close").dialog({position:"center",height:"auto",width:510,title:a.t("title.forward_messages","Forward Messages"),buttons:[{text:a.t("buttons.send_message","Send"),click:function(){return d(this).submit()}},{text:a.t("#buttons.cancel","Cancel"),click:function(){return d(this).dialog("close")}}],close:function(){return d("#forward_recipients").data("token_input").input.blur()}})}),e.submit(function(a){var b;return b=!!d(this).find("#forward_body").val()&&!!d(this).find(".token_input li").length,b||a.stopImmediatePropagation(),b}),e.formSubmit({beforeSubmit:function(){return d(this).loadingImage()},success:function(a){var b,e;return e=a[0],d(this).loadingImage("remove"),b=d("#conversation_"+e.id),b.length?(C(b)&&r(e.messages[0]).prependTo(k).slideDown("fast"),R(b,e)):c(e),M("#/conversations/"+e.id),I(),d(this).dialog("close")},error:function(a){return d(this).loadingImage("remove"),d(this).dialog("close")}}),d("#cancel_bulk_message_action").click(function(){return Q(!1)}),d("#conversation_blank .audience, #create_message_form .audience").click(function(a){var b;if((b=d(a.target).closest("span.others").find("> span")).length)return d(a.target).closest("span.others > span").length||(d("span.others > span").not(b).hide(),b.toggle(),b.css("left",b.parent().position().left),b.css("top",b.parent().height()+b.parent().position().top)),a.preventDefault(),!1}),p=0,d("#action_add_attachment").click(function(a){var b;return a.preventDefault(),b=d("#attachment_blank").clone(!0),b.attr("id",null),b.find("input[type='file']").attr("name","attachments["+p++ +"]"),d("#attachment_list").append(b),b.slideDown("fast",function(){return B()}),!1}),d("#attachment_blank a.remove_link").click(function(a){return a.preventDefault(),d(this).parents(".attachment").slideUp("fast",function(){return B(),d(this).remove()}),!1}),d("#action_media_comment").click(function(a){return a.preventDefault(),d("#create_message_form .media_comment").mediaComment("create","audio",function(a,b){return d("#media_comment_id").val(a),d("#media_comment_type").val(b),d("#create_message_form .media_comment").show(),d("#action_media_comment").hide()})}),d("#create_message_form .media_comment a.remove_link").click(function(a){return a.preventDefault(),d("#media_comment_id").val(""),d("#media_comment_type").val(""),d("#create_message_form .media_comment").hide(),d("#action_media_comment").show()}),x=n.initial_conversations;for(s=0,t=x.length;s<t;s++)o=x[s],c(o,!0);return d("#no_messages").showIf(!g.find("li:not([id=conversations_loader])").length),d(".recipients").tokenInput({placeholder:a.t("recipient_field_placeholder","Enter a name, course, or group"),added:function(b,c,e){var f,g,h;e&&b.type&&(c.addClass(b.type),b.user_count!=null&&(c.addClass("details"),f=d("<span />"),f.text(a.t("people_count","person",{count:b.user_count})),c.append(f)));if(!b.id||!(""+b.id).match(/^(course|group)_/))return b=d.extend({},b),delete b.avatar_url,g=(h=n.user_cache[b.id])!=null?h:{},n.user_cache[b.id]=d.extend(g,b)},selector:{messages:{no_results:a.t("no_results","No results found")},populator:function(b,c,e){var f,g,h,i,j,k,l;e==null&&(e={}),c.avatar_url&&(h=d('<img class="avatar" />'),h.attr("src",c.avatar_url),b.append(h)),k=c.context_name?c.context_name:"",k=k.length<40?k:k.substr(0,40)+"...",g=c.context_name?d("<span />",{"class":"context_name"}).text("("+k+")"):"",f=d("<b />"),f.text(c.name),i=d("<span />",{"class":"name"}),i.append(f,g),j=d("<span />",{"class":"details"}),c.common_courses!=null?j.text(n.context_list({courses:c.common_courses,groups:c.common_groups})):c.type&&c.user_count!=null?j.text(a.t("people_count","person",{count:c.user_count})):c.item_count!=null&&(c.id.match(/_groups$/)?j.text(a.t("groups_count","group",{count:c.item_count})):c.id.match(/_sections$/)&&j.text(a.t("sections_count","section",{count:c.item_count}))),b.append(i,j),b.attr("title",c.name),l=c.name,e.parent&&(c.select_all&&c.no_expand?l=e.parent.data("text"):(c.id+"").match(/_\d+_/)&&(l=a.beforeLabel(e.parent.data("text"))+" "+l)),b.data("text",l),b.data("id",c.id),b.data("user_data",c),b.addClass(c.type?c.type:"user"),e.level>0&&(b.prepend('<a class="toggle"><i></i></a>'),c.item_count||b.addClass("toggleable"));if(c.type==="context"&&!c.no_expand)return b.prepend('<a class="expand"><i></i></a>'),b.addClass("expandable")},limiter:function(a){return a.level>0?-1:5},preparer:function(b,c,d){var e;e=b.context;if(!b.search&&e&&c.length>1){if(e.match(/^(course|section)_\d+$/))return c.unshift({id:""+e+"_all",name:a.t("enrollments_everyone","Everyone"),user_count:d.data("user_data").user_count,type:"context",avatar_url:d.data("user_data").avatar_url,select_all:!0});if(e.match(/^((course|section)_\d+_.*|group_\d+)$/)&&!e.match(/^course_\d+_(groups|sections)$/))return c.unshift({id:e,name:a.t("select_all","Select All"),user_count:d.data("user_data").user_count,type:"context",avatar_url:d.data("user_data").avatar_url,select_all:!0,no_expand:!0})}},base_data:{synthetic_contexts:1},browser:{data:{per_page:-1,type:"context"}}}}),q=d("#recipients").data("token_input"),q.fake_input.css("width","100%"),q.change=function(a){var b,c;return a.length>1||((c=a[0])!=null?c.match(/^(course|group)_/):void 0)?(i.find("#group_conversation_info").is(":visible")||i.find("#group_conversation").attr("checked",!1),i.find("#group_conversation_info").show(),i.find("#user_note_info").hide()):(i.find("#group_conversation").attr("checked",!1),i.find("#group_conversation_info").hide(),i.find("#user_note_info").showIf((b=n.user_cache[a[0]])&&u(b))),B()},d(window).resize(B),setTimeout(B),setTimeout(function(){return g.pageless({totalPages:Math.ceil(n.initial_conversations_count/n.conversation_page_size),container:g,params:{format:"json",per_page:n.conversations_per_page},loader:d("#conversations_loader"),scrape:function(a){var b,e,f;if(typeof a=="string"){try{a=d.parseJSON(a)||[]}catch(h){a=[]}for(e=0,f=a.length;e<f;e++)b=a[e],c(b,!0)}return g.append(d("#conversations_loader")),!1}},1)}),d(window).bind("hashchange",function(){var a,b,c,e;b=location.hash;if(c=b.match(/^#\/conversations\/(\d+)(\?(.*))?/))return e=c[3]?F(c[3]):{},(a=d("#conversation_"+c[1]))&&a.length?J(a,e):K(c[1],e);if(d("#action_compose_message").length){e={};if(c=b.match(/^#\/conversations\?(.*)$/))e=F(c[1]);return J(null,e)}}).triggerHandler("hashchange")})}}),n})}.call(this),function(){require(["compiled/messages","compiled/slideshow","compiled/conversations_intro","vendor/jquery.elastic","vendor/jquery.cookie"])}.call(this),define("compiled/bundles/messages",function(){})
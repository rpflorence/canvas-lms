(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["jquery","jquery.ajaxJSON"],function(b){var c;return c=function(){function c(a,b,c){var d,e,f;this.url=a,this.handler=b,c==null&&(c={}),this.baseInterval=(d=c.baseInterval)!=null?d:1e3,this.backoffFactor=(e=c.backoffFactor)!=null?e:1.5,this.maxAttempts=(f=c.maxAttempts)!=null?f:8}return c.prototype.start=function(){return this.running?this.reset():this.nextPoll(!0),this},c.prototype.then=function(a){var b;return(b=this.callbacks)==null&&(this.callbacks=[]),this.callbacks.push(a)},c.prototype.reset=function(){return this.nextInterval=this.baseInterval,this.attempts=0},c.prototype.stop=function(a){var b,c,d,e;a==null&&(a=!1),this.running&&clearTimeout(this.running),delete this.running;if(a&&this.callbacks){e=this.callbacks;for(c=0,d=e.length;c<d;c++)b=e[c],b()}return delete this.callbacks},c.prototype.poll=function(){return this.running=!0,this.attempts++,b.ajaxJSON(this.url,"GET",{},a(function(a){switch(this.handler(a)){case"continue":return this.nextPoll();case"reset":return this.nextPoll(!0);case"stop":return this.stop(!0);default:return this.stop()}},this),a(function(a){return this.stop()},this))},c.prototype.nextPoll=function(a){return a==null&&(a=!1),a?this.reset():this.nextInterval=parseInt(this.nextInterval*this.backoffFactor),this.attempts>this.maxAttempts?this.stop():this.running=setTimeout(b.proxy(this.poll,this),this.nextInterval)},c}()})}).call(this)
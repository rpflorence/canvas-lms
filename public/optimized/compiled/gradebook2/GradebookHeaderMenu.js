(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["i18n","jquery","message_students","compiled/AssignmentDetailsDialog","compiled/AssignmentMuter","jst/gradebook2/GradebookHeaderMenu","jst/re_upload_submissions_form","jquery.instructure_forms","jquery.instructure_jquery_patches","jquery.instructure_misc_helpers","jquery.instructure_misc_plugins","compiled/jquery.kylemenu"],function(b,c,d,e,f,g,h){var i;return b=b.scoped("gradebook2"),i=function(){function d(b,d,e){var h;this.assignment=b,this.$trigger=d,this.gradebook=e,this.reuploadSubmissions=a(this.reuploadSubmissions,this),this.downloadSubmissions=a(this.downloadSubmissions,this),this.curveGrades=a(this.curveGrades,this),this.setDefaultGrade=a(this.setDefaultGrade,this),this.messageStudentsWho=a(this.messageStudentsWho,this),this.showAssignmentDetails=a(this.showAssignmentDetails,this),h={assignmentUrl:""+this.gradebook.options.context_url+"/assignments/"+this.assignment.id,speedGraderUrl:""+this.gradebook.options.context_url+"/gradebook/speed_grader?assignment_id="+this.assignment.id},this.$menu=c(g(h)).insertAfter(this.$trigger),this.$trigger.kyleMenu({noButton:!0}),this.$menu.appendTo("#gradebook_grid").delegate("a","click",a(function(a){var b;b=this[c(a.target).data("action")];if(b)return b(),!1},this)).bind("popupopen popupclose",a(function(a){return this.$trigger.toggleClass("ui-menu-trigger-menu-is-open",a.type==="popupopen")},this)).bind("popupopen",a(function(){var a,b,c,d;c={showAssignmentDetails:this.gradebook.allSubmissionsLoaded,messageStudentsWho:this.gradebook.allSubmissionsLoaded,setDefaultGrade:this.gradebook.allSubmissionsLoaded,curveGrades:this.gradebook.allSubmissionsLoaded&&this.assignment.grading_type!=="pass_fail"&&this.assignment.points_possible,downloadSubmissions:(""+this.assignment.submission_types).match(/(online_upload|online_text_entry|online_url)/),reuploadSubmissions:this.assignment.submissions_downloads>0},d=[];for(a in c)b=c[a],d.push(this.$menu.find("[data-action="+a+"]").showIf(b));return d},this)).popup("open"),new f(this.$menu.find("[data-action=toggleMuting]"),this.assignment,""+this.gradebook.options.context_url+"/assignments/"+this.assignment.id+"/mute")}return d.prototype.showAssignmentDetails=function(){return new e(this.assignment,this.gradebook)},d.prototype.messageStudentsWho=function(){var a,d,e;return e=function(){var b,e;b=this.gradebook.students,e=[];for(a in b)d=b[a],e.push(c.extend({id:d.id,name:d.name},d["assignment_"+this.assignment.id]));return e}.call(this),window.messageStudents({options:[{text:b.t("students_who.havent_submitted_yet","Haven't submitted yet")},{text:b.t("students_who.scored_less_than","Scored less than"),cutoff:!0},{text:b.t("students_who.scored_more_than","Scored more than"),cutoff:!0}],title:this.assignment.name,points_possible:this.assignment.points_possible,students:e,callback:function(a,e,f){return f=c.grep(f,function(c,f){d=c.user_data;if(a===b.t("not_submitted_yet","Haven't submitted yet"))return!d.submitted_at;if(a===b.t("scored_less_than","Scored less than"))return d.score!=null&&d.score!==""&&e!=null&&d.score<e;if(a===b.t("scored_more_than","Scored more than"))return d.score!=null&&d.score!==""&&e!=null&&d.score>e}),c.map(f,function(a){return a.user_data.id})}})},d.prototype.setDefaultGrade=function(){return new SetDefaultGradeDialog(this.assignment,this.gradebook)},d.prototype.curveGrades=function(){return new CurveGradesDialog(this.assignment,this.gradebook)},d.prototype.downloadSubmissions=function(){var a,b,d;return a=c.replaceTags(this.gradebook.options.download_assignment_submissions_url,"assignment_id",this.assignment.id),INST.downloadSubmissions(a),this.assignment.submissions_downloads=((d=(b=this.assignment).submissions_downloads)!=null?d:b.submissions_downloads=0)+1},d.prototype.reuploadSubmissions=function(){var a;return this.$re_upload_submissions_form||(d.prototype.$re_upload_submissions_form=c(h()).dialog({width:400,modal:!0,resizable:!1,autoOpen:!1}).submit(function(){var a;a=c(this).getFormData();if(!a.submissions_zip)return!1;if(!a.submissions_zip.match(/\.zip$/))return c(this).formErrors({submissions_zip:b.t("errors.upload_as_zip","Please upload files as a .zip")}),!1})),a=c.replaceTags(this.gradebook.options.re_upload_submissions_url,"assignment_id",this.assignment.id),this.$re_upload_submissions_form.attr("action",a).dialog("open")},d}()})}).call(this)
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define(["jquery","jquery.ajaxJSON"],function(b){return this.SubmissionCell=function(){function c(a){this.opts=a,this.init()}return c.prototype.init=function(){var a;return a=this.opts.item[this.opts.column.field],this.$wrapper=b(this.cellWrapper('<input class="grade"/>')).appendTo(this.opts.container),this.$input=this.$wrapper.find("input").focus().select()},c.prototype.destroy=function(){return this.$input.remove()},c.prototype.focus=function(){return this.$input.focus()},c.prototype.loadValue=function(){return this.val=this.opts.item[this.opts.column.field].grade||"",this.$input.val(this.val),this.$input[0].defaultValue=this.val,this.$input.select()},c.prototype.serializeValue=function(){return this.$input.val()},c.prototype.applyValue=function(a,b){var c;return a[this.opts.column.field].grade=b,(c=this.wrapper)!=null&&c.remove(),this.postValue(a,b)},c.prototype.postValue=function(c,d){var e,f;return e=c[this.opts.column.field],f=this.opts.grid.getOptions().change_grade_url,f=f.replace(":assignment",e.assignment_id).replace(":submission",e.user_id),b.ajaxJSON(f,"PUT",{"submission[posted_grade]":d},a(function(a){return b.publish("submissions_updated",[[a]])},this))},c.prototype.isValueChanged=function(){return this.val!==this.$input.val()},c.prototype.validate=function(){return{valid:!0,msg:null}},c.formatter=function(a,b,c,d){return this.prototype.cellWrapper(c.grade,{submission:c,assignment:d,editable:!1})},c.prototype.cellWrapper=function(a,d){var e,f,g,h;return d==null&&(d={}),e=b.extend({},{innerContents:"",classes:"",editable:!0},d),e.submission||(e.submission=this.opts.item[this.opts.column.field]),e.assignment||(e.assignment=this.opts.column.object),f=c.classesBasedOnSubmission(e.submission,e.assignment),g=b.map(f,function(a){return GRADEBOOK_TRANSLATIONS["submission_tooltip_"+a]}).join(", "),e.submission.grade||(e.classes+=" no_grade_yet "),a==null&&(a=((h=e.submission)!=null?h.submission_type:void 0)?'<span class="submission_type_icon" />':"-"),""+(g?'<div class="gradebook-tooltip">'+g+"</div>":"")+'\n<div class="gradebook-cell '+(e.editable?"gradebook-cell-editable focus":"")+" "+e.classes+" "+f.join(" ")+'">\n  <a href="#" data-user-id='+e.submission.user_id+" data-assignment-id="+e.assignment.id+' class="gradebook-cell-comment"><span class="gradebook-cell-comment-label">submission comments</span></a>\n  '+a+"\n</div>"},c.classesBasedOnSubmission=function(a,b){var c;return a==null&&(a={}),b==null&&(b={}),c=[],a.grade_matches_current_submission===!1&&c.push("resubmitted"),b.due_at&&a.submitted_at&&a.submitted_at.timestamp>b.due_at.timestamp&&c.push("late"),a.drop&&c.push("dropped"),""+b.submission_types=="not_graded"&&c.push("ungraded"),b.muted&&c.push("muted"),a.submission_type&&c.push(a.submission_type),c},c}(),SubmissionCell.out_of=function(){function a(){a.__super__.constructor.apply(this,arguments)}return c(a,SubmissionCell),a.prototype.init=function(){var a;return a=this.opts.item[this.opts.column.field],this.$wrapper=b(this.cellWrapper('<div class="overflow-wrapper">\n  <div class="grade-and-outof-wrapper">\n    <input type="number" class="grade"/><span class="outof"><span class="divider">/</span>'+this.opts.column.object.points_possible+"</span>\n  </div>\n</div>",{classes:"gradebook-cell-out-of-formatter"})).appendTo(this.opts.container),this.$input=this.$wrapper.find("input").focus().select()},a}(),SubmissionCell.pass_fail=function(){function f(){f.__super__.constructor.apply(this,arguments)}var d,e;return c(f,SubmissionCell),e=["pass","fail",""],d=function(a){return{pass:"pass",complete:"pass",fail:"fail",incomplete:"fail"}[a.grade]||""},f.prototype.htmlFromSubmission=function(a){var b;return a==null&&(a={}),b=d(a.submission),SubmissionCell.prototype.cellWrapper('<a data-value="'+b+'" class="gradebook-checkbox gradebook-checkbox-'+b+" "+(a.editable?"editable":void 0)+'" href="#">'+b+"</a>",a)},f.formatter=function(a,b,c,d){return c.grade==null?SubmissionCell.formatter.apply(this,arguments):f.prototype.htmlFromSubmission({submission:c,assignment:d,editable:!1})},f.prototype.init=function(){return this.$wrapper=b(this.cellWrapper()),this.$wrapper=b(this.htmlFromSubmission({submission:this.opts.item[this.opts.column.field],assignment:this.opts.column.object,editable:!0})).appendTo(this.opts.container),this.$input=this.$wrapper.find(".gradebook-checkbox").bind("click keypress",a(function(a){var b,c;return a.preventDefault(),b=this.$input.data("value"),b==="pass"?c="fail":b==="fail"?c="":c="pass",this.transitionValue(c)},this)).focus()},f.prototype.destroy=function(){return this.$wrapper.remove()},f.prototype.transitionValue=function(a){return this.$input.removeClass("gradebook-checkbox-pass gradebook-checkbox-fail").addClass("gradebook-checkbox-"+d({grade:a})).data("value",a)},f.prototype.loadValue=function(){return this.val=this.opts.item[this.opts.column.field].grade||""},f.prototype.serializeValue=function(){return this.$input.data("value")},f.prototype.isValueChanged=function(){return this.val!==this.$input.data("value")},f}(),SubmissionCell.points=function(){function a(){a.__super__.constructor.apply(this,arguments)}return c(a,SubmissionCell),a}()})}).call(this)
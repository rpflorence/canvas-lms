(function(){var a=tinymce.dom.Event,b=tinymce.each,c=tinymce.DOM;tinymce.create("tinymce.plugins.ContextMenu",{init:function(b,c){function f(){e=!e,$(b.getBody()).attr("spellcheck",e),cm=b.controlManager,cm.setActive("instructure_table_mode",!e)}function g(){d._menu&&(d._menu.removeAll(),d._menu.destroy(),a.remove(b.getDoc(),"click",g))}var d=this;d.editor=b,d.onContextMenu=new tinymce.util.Dispatcher(this),b.onContextMenu.add(function(b,c){var f=!1,h=c.target;while(h.nodeName!="TABLE"&&h.nodeName!="BODY"&&h.parentNode)h=h.parentNode;if(h.nodeName=="TABLE"){var i=b.selection.getRng(!0);if(!i||i.startOffset==i.endOffset&&i.startContainer==i.endContainer)f=!0}!c.ctrlKey&&(f||!e)&&(d._getMenu(b).showMenu(c.clientX,c.clientY),a.add(b.getDoc(),"click",g),a.cancel(c))});var e=!1;b.addCommand("toggleSpellCheck",f),b.onInit.add(function(a,b,c){f()}),b.addButton("instructure_table_mode",{title:"Turn on Advanced Mode (right-click table editing, disables spell-check)",cmd:"toggleSpellCheck",image:c+"/img/button.png"}),b.onMouseDown.add(g),b.onKeyDown.add(g)},getInfo:function(){return{longname:"Contextmenu",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/contextmenu",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_getMenu:function(a){var b=this,d=b._menu,e=a.selection,f=e.isCollapsed(),g=e.getNode()||a.getBody(),h,i,j;d&&(d.removeAll(),d.destroy()),i=c.getPos(a.getContentAreaContainer()),j=c.getPos(a.getContainer()),d=a.controlManager.createDropMenu("contextmenu",{offset_x:i.x+a.getParam("contextmenu_offset_x",0),offset_y:i.y+a.getParam("contextmenu_offset_y",0),constrain:1}),b._menu=d,d.add({title:"advanced.cut_desc",icon:"cut",cmd:"Cut"}).setDisabled(f),d.add({title:"advanced.copy_desc",icon:"copy",cmd:"Copy"}).setDisabled(f),d.add({title:"advanced.paste_desc",icon:"paste",cmd:"Paste"});if(g.nodeName=="A"&&!a.dom.getAttrib(g,"name")||!f)d.addSeparator(),d.add({title:"advanced.link_desc",icon:"link",cmd:"instructureLinks",ui:!0}),d.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"});return d.addSeparator(),d.add({title:"advanced.image_desc",icon:"image",cmd:"instructureEmbed",ui:!0}),d.addSeparator(),h=d.addMenu({title:"contextmenu.align"}),h.add({title:"contextmenu.left",icon:"justifyleft",cmd:"JustifyLeft"}),h.add({title:"contextmenu.center",icon:"justifycenter",cmd:"JustifyCenter"}),h.add({title:"contextmenu.right",icon:"justifyright",cmd:"JustifyRight"}),h.add({title:"contextmenu.full",icon:"justifyfull",cmd:"JustifyFull"}),b.onContextMenu.dispatch(b,d,g,f),d}}),tinymce.PluginManager.add("instructure_contextmenu",tinymce.plugins.ContextMenu)})()
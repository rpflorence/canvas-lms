require(["i18n","jquery","str/htmlEscape","jquery.instructure_jquery_patches","jquery.instructure_misc_helpers","tinymce.editor_box"],function(a,b,c){function l(){d=b("<div/>",{html:k.instructions+"<form id='instructure_embed_prompt_form' style='margin-top: 5px;'><table class='formtable'><tr><td>"+k.url+"</td><td><input type='text' class='prompt' style='width: 250px;' value='http://'/></td></tr><tr><td class='nobr'>"+k.alt_text+"</td><td><input type='text' class='alt_text' style='width: 150px;' value=''/></td></tr><tr><td colspan='2' style='text-align: right;'><input type='submit' value='Embed Image'/></td></tr></table></form><div class='actions'></div>"}).hide(),g=d.find(".alt_text"),h=d.find(".actions"),f=d.find(".prompt"),i=b("<a/>",{"class":"flickr_search_link",text:k.search_flickr,href:"#"}),f.bind("keyup",o),h.delegate(".embed_image_link","click",n),i.click(m),d.append(i).find("#instructure_embed_prompt_form").submit(n),b("body").append(d),d.dialog({autoOpen:!1,width:425,title:k.embed_external,open:function(){f.select()}}),j=!0}function m(a){a.preventDefault(),d.dialog("close"),b.findImageForService("flickr_creative_commons",function(a){var b=c(a.title),f='<a href="'+a.link_url+'"><img src="'+a.image_url+'" title="'+b+'"alt="'+b+'" style="max-width: 500; max-height: 500"></a>';d.dialog("close"),e.editorBox("insert_code",f)})}function n(a){var b=c(g.val()||""),h=c(f.val());a.preventDefault(),e.editorBox("insert_code","<img src='"+h+"' alt='"+b+"'/>"),d.dialog("close")}function o(a){var b=f.val();return b.match(/\.(gif|png|jpg|jpeg)$/)?q(b):p()}function p(){h.empty()}function q(a){var c=b("<div/>"),d=b("<img/>");c.css("textAlign","center").text(k.loading),h.empty(),h.append(c),d.attr({src:a,title:k.click_to_embed}).addClass("embed_image_link").css("cursor","pointer").bind({load:function(){var a=d[0];d.height(a.height<200?a.height:100),c.empty().append(d)},error:function(){c.text(k.image_not_found)}})}a=a.scoped("#tinymce");var d,e,f,g,h,i,j=!1,k={click_to_embed:a.t("click_to_embed","Click to embed the image"),instructions:c(a.t("instructions","Paste or type the URL of the image you'd like to embed:")),url:c(a.t("url","URL:")),alt_text:c(a.t("alt_text","Alternate Text:")),search_flickr:a.t("alt_text","Search flickr creative commons"),loading:a.t("loading","Loading..."),embed_external:a.t("embed_external","Embed External Image"),embed_image:c(a.t("embed_image","Embed Image")),image_not_found:a.t("image_not_found","Image not found, please try a new URL")};tinymce.create("tinymce.plugins.InstructureEmbed",{init:function(a,c){var f=b("#"+a.id);a.addCommand("instructureEmbed",function(a){j||l(),e=f,d.dialog("open"),a==="flickr"&&i.click()}),a.addButton("instructure_embed",{title:k.embed_image,cmd:"instructureEmbed",image:c+"/img/button.gif"})},getInfo:function(){return{longname:"InstructureEmbed",author:"Brian Whitmer",authorurl:"http://www.instructure.com",infourl:"http://www.instructure.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("instructure_embed",tinymce.plugins.InstructureEmbed)})
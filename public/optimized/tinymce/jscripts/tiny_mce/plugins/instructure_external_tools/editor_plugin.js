require(["i18n","jquery","str/htmlEscape","jquery.dropdownList","jquery.instructure_jquery_patches","jquery.instructure_misc_helpers","jquery.instructure_misc_plugins","tinymce.editor_box"],function(a,b,c){a=a.scoped("#tinymce");var d={embed_from_external_tool:a.t("embed_from_external_tool",'"Embed content from External Tool"'),more_external_tools:c(a.t("more_external_tools","More External Tools"))};tinymce.create("tinymce.plugins.InstructureExternalTools",{init:function(a,c){function g(c){var f=Math.max(Math.min(b(window).height()-100,550),100);e||(e=b('<div id="external_tool_button_dialog" style="padding: 0; overflow-y: hidden;"/>').hide().html("<div class='teaser' style='width: 800px; margin-bottom: 10px; display: none;'></div><iframe id='external_tool_button_frame' style='width: 800px; height: "+f+"px; border: 0;' src='/images/ajax-loader-medium-444.gif' borderstyle='0'/>").appendTo("body").dialog({autoOpen:!1,width:"auto",resizable:!0,close:function(){e.find("iframe").attr("src","/images/ajax-loader-medium-444.gif")},title:d.embed_from_external_tool}).bind("dialogresize",function(){b(this).find("iframe").add(".fix_for_resizing_over_iframe").height(b(this).height()).width(b(this).width())}).bind("dialogresizestop",function(){b(".fix_for_resizing_over_iframe").remove()}).bind("dialogresizestart",function(){b(this).find("iframe").each(function(){b('<div class="fix_for_resizing_over_iframe" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e7}).css(b(this).offset()).appendTo("body")})}).bind("selection",function(c,d){var f=e.data("editor")||a;if(d.embed_type=="basic_lti")if(b("#external_tool_retrieve_url").attr("href")){var g=b.replaceTags(b("#external_tool_retrieve_url").attr("href"),"url",d.url);b("#"+a.id).editorBox("create_link",{url:g,title:d.title,text:d.text})}else console.log("cannot embed basic lti links in this context");else if(d.embed_type=="image"){var h=b("<div/>").append(b("<img/>",{src:d.url,alt:d.alt}).css({width:d.width,height:d.height})).html();b("#"+a.id).editorBox("insert_code",h)}else if(d.embed_type=="link")b("#"+a.id).editorBox("create_link",{url:d.url,title:d.title,text:d.text,target:d.target=="_blank"?"_blank":null});else if(d.embed_type=="iframe"){var h=b("<div/>").append(b("<iframe/>",{src:d.url,title:d.title}).css({width:d.width,height:d.height})).html();b("#"+a.id).editorBox("insert_code",h)}else d.embed_type=="rich_content"?b("#"+a.id).editorBox("insert_code",d.html):d.embed_type=="error"&&d.message?alert(d.message):console.log("unrecognized embed type: "+d.embed_type);b("#external_tool_button_dialog iframe").attr("src","about:blank"),b("#external_tool_button_dialog").dialog("close")})),e.dialog("option","title","Embed content from "+c.name),e.dialog("close").dialog("option","width",c.width||800).dialog("option","height",c.height||f||400).dialog("open"),e.triggerHandler("dialogresize"),e.data("editor",a);var g=b.replaceTags(b("#context_external_tool_resource_selection_url").attr("href"),"id",c.id);e.find("iframe").attr("src",g)}if(!window||!window.INST||!window.INST.editorButtons||!window.INST.editorButtons.length)return;var e=null,f=[];for(var h in INST.editorButtons){var i=INST.editorButtons[h];INST.editorButtons.length>INST.maxVisibleEditorButtons&&h>=INST.maxVisibleEditorButtons-1?f.push(i):function(b){a.addCommand("instructureExternalButton"+b.id,function(){g(b)}),a.addButton("instructure_external_button_"+b.id,{title:b.name,cmd:"instructureExternalButton"+b.id,image:b.icon_url})}(i)}f.length&&(a.addCommand("instructureExternalButtonClump",function(){var c={};for(var d in f)(function(a){c["<img src='"+f[a].icon_url+"'/>&nbsp;"+f[a].name]=function(){g(f[a])}})(d);b("#"+a.id+"_instructure_external_button_clump").dropdownList({options:c})}),a.addButton("instructure_external_button_clump",{title:d.more_external_tools,cmd:"instructureExternalButtonClump",image:"/images/downtick.png"}))},getInfo:function(){return{longname:"InstructureExternalTools",author:"Brian Whitmer",authorurl:"http://www.instructure.com",infourl:"http://www.instructure.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("instructure_external_tools",tinymce.plugins.InstructureExternalTools)})
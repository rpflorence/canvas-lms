require(["jquery","calendar_move","wikiSidebar","jquery.instructure_date_and_time","jquery.instructure_forms","jquery.instructure_misc_helpers","jquery.instructure_misc_plugins","jquery.loadingImg","tinymce.editor_box","vendor/jquery.scrollTo","jqueryui/datepicker"],function(a,b,c){a(function(a){function j(){i.find(".day.has_event").removeClass("has_event"),h.find("tr.date").each(function(){var b=a(this).find(".day_date").attr("data-date").split("/"),c=b.join("_"),d=[b[2],b[0],b[1]].join("_");i.find(".mini_calendar_day.date_"+c+", #mini_day_"+d).addClass("has_event")})}function k(b,c){a("tr.date.related,.day.related").removeClass("related");if(b){var d=c.split("/"),e=d.join("_"),f=[d[2],d[0],d[1]].join("_");i.find(".mini_calendar_day.date_"+e+", #mini_day_"+f).add(h.find("tr.date.events_"+e)).addClass("related")}}var d=a("#edit_course_syllabus_form"),e=a("#course_syllabus_body"),f=a("#course_syllabus"),g=a("#course_syllabus_details"),h=a("#syllabus"),i=a(".mini_month");i.find(".next_month_link, .prev_month_link").bind("mousedown",function(c){c.preventDefault(),b.changeMonth(i,a(this).hasClass("next_month_link")?1:-1),j()}).bind("click",!1),i.delegate(".mini_calendar_day","click",function(c){c.preventDefault();var d=a(this).find(".day_number").attr("title");b.changeMonth(i,d),j(),a(".events_"+d.replace(/\//g,"_")).ifExists(function(b){a("html,body").scrollTo(b),k(!0,d)})}).delegate(".mini_calendar_day","mouseover mouseout",function(b){k(b.type==="mouseover",a(this).find(".day_number").attr("title"))}),h.delegate("tr.date","mouseenter mouseleave",function(b){k(b.type==="mouseenter",a(this).find(".day_date").attr("title"))}),a(".jump_to_today_link").click(function(c){c.preventDefault();var d=a.datepicker.formatDate("mm/dd/yy",new Date),e;a("tr.date").each(function(){var b=a(this).find(".day_date").attr("title");if(b>d)return!1;e=a(this)}),b.changeMonth(i,d),a("html,body").scrollTo(e||a("tr.date:first")),k(!0,d)}),c&&c.init(),d.bind("edit",function(){d.show(),f.hide(),g.hide(),e.editorBox(),e.editorBox("set_code",f.html()),c&&(c.attachToEditor(e),c.show(),a("#sidebar_content").hide())}),d.bind("hide_edit",function(){d.hide(),f.show();var b=a.trim(f.html());g.showIf(!b),e.editorBox("destroy"),a("#sidebar_content").show(),c&&c.hide()}),a(".edit_syllabus_link").click(function(b){b.preventDefault(),a("#edit_course_syllabus_form").triggerHandler("edit")}),d.find(".toggle_views_link").click(function(a){a.preventDefault(),e.editorBox("toggle")}),d.find(".cancel_button").click(function(a){d.triggerHandler("hide_edit"),a.preventDefault()}),d.formSubmit({object_name:"course",processData:function(a){return a["course[syllabus_body]"]=e.editorBox("get_code"),a},beforeSubmit:function(a){d.triggerHandler("hide_edit"),g.hide(),f.loadingImage()},success:function(a){f.loadingImage("remove").html(a.course.syllabus_body),g.hide()},error:function(a){d.triggerHandler("edit").formErrors(a)}}),a.scrollSidebar(),j()})})
require(["INST","i18n","jquery","str/htmlEscape","wikiSidebar","instructure_helper","instructure-jquery.ui.draggable-patch","jquery.ajaxJSON","jquery.doc_previews","jquery.dropdownList","jquery.google-analytics","jquery.instructure_date_and_time","jquery.instructure_forms","jquery.instructure_jquery_patches","jquery.instructure_misc_helpers","jquery.instructure_misc_plugins","jquery.keycodes","jquery.loadingImg","jquery.rails_flash_notifications","jquery.templateData","media_comments","tinymce.editor_box","vendor/date","vendor/jquery.ba-tinypubsub","vendor/jquery.store","jqueryui/accordion","jqueryui/resizable","jqueryui/sortable","jqueryui/tabs","vendor/scribd.view"],function(a,b,c,d,e){b=b.scoped("instructure"),c.ajaxPrefilter(function(a,b,d){var e=a.url,f=(new Date).getTime();d.done(function(a,b,d){var g=(new Date).getTime()-f;if(g>1e3){var h='{"requestingPage": "'+window.location+'," "status": "'+b+'", "X-Request-Context-Id" : "'+d.getResponseHeader("X-Request-Context-Id")+'", "X-Runtime": '+d.getResponseHeader("X-Runtime")+"}";c.trackEvent("XHRs",e,h,g)}})}),c(function(){function i(){window.clearTimeout(h),g.find(".menu-item").removeClass("hover hover-pending")}function j(){return f.filter(".hover-pending").removeClass("hover-pending"),h=window.setTimeout(i,400),!1}function k(a){var b=f.filter(".hover").length>0;i();var d=c(this);return d.addClass("hover-pending"),b&&d.addClass("hover"),setTimeout(function(){d.hasClass("hover-pending")&&d.addClass("hover")},300),c.publish("menu/hovered",d),!1}function o(){var a=500,b=l.find("li:visible:first").height()*1.5;m=m||l.find(".ellipsible"),m.css("maxWidth",""),m.ifExists(function(){for(var c=0;l.height()>b&&c<20;c++)n||(n=!0,m.addClass("ellipsis")),m.css("maxWidth",a-=20)})}function p(){var a=c("#content");c(".user_content:not(.enhanced):visible").addClass("unenhanced"),c(".user_content.unenhanced:visible").each(function(){var b=c(this);b.find("img").css("maxWidth",Math.min(a.width(),b.width())),b.data("unenhanced_content_html",b.html())}).find(".enhanceable_content").show().filter(".dialog").each(function(){var a=c(this);a.hide(),a.closest(".user_content").find("a[href='#"+a.attr("id")+"']").click(function(b){b.preventDefault(),a.dialog()})}).end().filter(".draggable").draggable().end().filter(".resizable").resizable().end().filter(".sortable").sortable().end().filter(".accordion").accordion().end().filter(".tabs").each(function(){c(this).tabs()}).end().end().find("a:not(.not_external, .external):external").each(function(){c(this).not(":has(img)").addClass("external").html("<span>"+c(this).html()+"</span>").attr("target","_blank").append('<span class="ui-icon ui-icon-extlink ui-icon-inline" title="'+d(b.t("titles.external_link","Links to an external site."))+'"/>')}).end().find("a.instructure_file_link").each(function(){var a=c(this),e=c("<span class='instructure_file_link_holder link_holder'/>");a.removeClass("instructure_file_link").before(e).appendTo(e),a.attr("target")!="_blank"&&e.append("<a href='"+a.attr("href")+"' target='_blank' title='"+d(b.t("titles.view_in_new_window","View in a new window"))+"' style='padding-left: 5px;'><img src='/images/popout.png'/></a>")}),c.filePreviewsEnabled()&&c("a.instructure_scribd_file").not(".inline_disabled").each(function(){var a=c(this);if(c.trim(a.text())){var e=c("<span class='instructure_scribd_file_holder link_holder'/>"),f=c("<a class='scribd_file_preview_link' href='"+a.attr("href")+"' title='"+d(b.t("titles.preview_document","Preview the document"))+"' style='padding-left: 5px;'><img src='/images/preview.png'/></a>");a.removeClass("instructure_scribd_file").before(e).appendTo(e),e.append(f),a.hasClass("auto_open")&&f.click()}}),c(".user_content.unenhanced a").find("img.media_comment_thumbnail").each(function(){c(this).closest("a").addClass("instructure_inline_media_comment")}).end().filter(".instructure_inline_media_comment").removeClass("no-underline").mediaCommentThumbnail("normal").end().filter(".instructure_video_link, .instructure_audio_link").mediaCommentThumbnail("normal",!0).end().not(".youtubed").each(function(){var a=c(this),e=a.attr("href"),f=c.youTubeID(e||"");if(!a.hasClass("inline_disabled")&&f){var g=c('<a href="'+e+'" class="youtubed"><img src="/images/play_overlay.png" class="media_comment_thumbnail" style="background-image: url(//img.youtube.com/vi/'+f+'/2.jpg)"/></a>').click(function(a){a.preventDefault();var e=c("<span class='youtube_holder' style='display: block;'><object width='425' height='344'><param name='wmode' value='opaque'></param><param name='movie' value='//www.youtube.com/v/"+f+"&autoplay=1&hl=en_US&fs=1&'></param><param name='allowFullScreen' value='true'></param><param name='allowscriptaccess' value='always'></param><embed src='//www.youtube.com/v/"+f+"&autoplay=1&hl=en_US&fs=1&' type='application/x-shockwave-flash' allowscriptaccess='always' allowfullscreen='true' width='425' height='344' wmode='opaque'></embed></object><br/><a href='#' style='font-size: 0.8em;' class='hide_youtube_embed_link'>"+d(b.t("links.minimize_youtube_video","Minimize Video"))+"</a></span>");e.find(".hide_youtube_embed_link").click(function(a){a.preventDefault(),e.remove(),g.show(),c.trackEvent("hide_embedded_content","hide_you_tube")}),c(this).after(e).hide()});c.trackEvent("show_embedded_content","show_you_tube"),a.addClass("youtubed").after(g)}}),c(".user_content.unenhanced").removeClass("unenhanced").addClass("enhanced"),setTimeout(function(){c(".user_content form.user_content_post_form:not(.submitted)").submit().addClass("submitted")},10)}function s(){r=c(".time_ago_date:visible").toArray(),t()}function t(){var a=r.shift();if(a){var d=c(a),e=d.data("original_date")||"",f=d.data("parsed_date")||(e?Date.parse(e.replace(/ (at|by)/,"")):Date.parse((d.text()||"").replace(/ (at|by)/,"")));if(f){var g=new Date;g.setDate(g.getDate()+1);if(!e&&f>g&&f-g>36e5){var h=f.getUTCFullYear().toString();f>g&&f.getUTCFullYear()==g.getUTCFullYear()&&!d.text().match(h)&&f.setUTCFullYear(f.getUTCFullYear()-1)}var i=g.getTimezoneOffset()-q;isNaN(i)&&(i=0);var j=g-f+i*60*1e3;d.data("original_date",f.toString("MMM d, yyyy h:mmtt")),d.data("parsed_date",f);var k=f.toString("MMM d, yyyy")+f.toString(" h:mmtt").toLowerCase(),l=k;if(j<864e5)if(j<36e5)if(j<6e4)l=b.t("#time.less_than_a_minute_ago","less than a minute ago");else{var m=parseInt(j/6e4,10);l=b.t("#time.count_minutes_ago",{one:"1 minute ago",other:"%{count} minutes ago"},{count:m})}else{var n=parseInt(j/36e5,10);l=b.t("#time.count_hours_ago",{one:"1 hour ago",other:"%{count} hours ago"},{count:n})}d.text(l),d.attr("title",k)}setTimeout(t,1)}else setTimeout(s,6e4)}function w(a){c("#wizard_spacer_box").height(v.height()||0).showIf(a==="show")}window._earlyClick&&(document.removeEventListener?document.removeEventListener("click",_earlyClick,!1):document.detachEvent("onclick",_earlyClick),_earlyClick.clicks&&setTimeout(function(){c.each(c.uniq(_earlyClick.clicks),function(){var a=c.Event("click");a.preventDefault(),c(this).trigger(a)})},1)),c("#main:not(.already_sized)").css({minHeight:Math.max(c("#left_side").height(),parseInt((c("#main").css("minHeight")||"").replace("px",""),10))});var f=c(".menu-item"),g=c("#menu"),h;g.delegate(".menu-item","mouseenter focusin",k).delegate(".menu-item","mouseleave focusout",j),a.browser.ie7&&c(".menu-item-drop").width(function(){var a=c(this).find(".menu-item-drop-column");return a.length*a.css("width").replace("px","")}),f.live("touchstart",function(){if(!c(this).hasClass("hover"))return k.call(this,event)}),c(document).bind("touchstart",function(a){c(a.target).closest(".menu-item").length||j()});var l=c("#breadcrumbs"),m,n=!1;o(),c(window).resize(o),c("#ajax_authenticity_token").ifExists(function(){this.text()&&c("input[name='authenticity_token']").val(this.text())}),c(document).keycodes("shift+/",function(a){c("#keyboard_navigation").dialog("close").dialog({title:b.t("titles.keyboard_shortcuts","Keyboard Shortcuts"),width:400,height:"auto",autoOpen:!1}).dialog("open")}),c("#switched_role_type").ifExists(function(){var a=c(this).attr("class"),d=c("<img/>"),e=null;switch(c(this).data("role")){case"TeacherEnrollment":e=b.t("switched_roles_message.teacher","You have switched roles temporarily for this course, and are now viewing the course as a teacher.  You can restore your role and permissions from the course home page.");break;case"StudentEnrollment":e=b.t("switched_roles_message.student","You have switched roles temporarily for this course, and are now viewing the course as a student.  You can restore your role and permissions from the course home page.");break;case"TaEnrollment":e=b.t("switched_roles_message.ta","You have switched roles temporarily for this course, and are now viewing the course as a TA.  You can restore your role and permissions from the course home page.");break;case"ObserverEnrollment":e=b.t("switched_roles_message.observer","You have switched roles temporarily for this course, and are now viewing the course as an observer.  You can restore your role and permissions from the course home page.");break;case"DesignerEnrollment":e=b.t("switched_roles_message.designer","You have switched roles temporarily for this course, and are now viewing the course as a designer.  You can restore your role and permissions from the course home page.");break;default:e=b.t("switched_roles_message.student","You have switched roles temporarily for this course, and are now viewing the course as a student.  You can restore your role and permissions from the course home page.")}d.attr("src","/images/warning.png").attr("title",e).css({paddingRight:2,width:12,height:12}),c("#crumb_"+a).find("a").prepend(d)}),c("a.show_quoted_text_link").live("click",function(a){var b=c(this).parents(".quoted_text_holder").children(".quoted_text");b.length>0&&(a.preventDefault(),b.show(),c(this).hide())}),c(".custom_search_results_link").click(function(a){a.preventDefault();var d=c("#custom_search_results_dialog");d.dialog("close").dialog({autoOpen:!1,title:b.t("titles.search_for_open_resources","Search for Open Resources"),width:600,height:400}).dialog("open");var e=d.data("searchControl");e&&e.execute(c("title").text())}),c("a.instructure_inline_media_comment").live("click",function(d){d.preventDefault();if(a.kalturaSettings){var e=c(this),f=c("<span><span></span></span>"),g="video",h=e.data("media_comment_id")||e.find(".media_comment_id:first").text();f.css("display","block"),!h&&e.attr("id")&&e.attr("id").match(/^media_comment_/)&&(h=e.attr("id").substring(14)),e.after(f),e.hide();if(e.data("media_comment_type")==="audio"||e.is(".audio_playback, .audio_comment, .instructure_audio_link"))g="audio";f.children("span").mediaComment("show_inline",h,g,e.attr("href")),f.append("<br/><a href='#' style='font-size: 0.8em;' class='hide_flash_embed_link'>"+b.t("links.minimize_embedded_kaltura_content","Minimize Embedded Content")+"</a>"),f.find(".hide_flash_embed_link").click(function(a){a.preventDefault(),f.remove(),e.show(),c.trackEvent("hide_embedded_content","hide_media")}),c.trackEvent("show_embedded_content","show_media")}else alert(b.t("alerts.kaltura_disabled","Kaltura has been disabled for this Canvas site"))}),c("a.equella_content_link").live("click",function(a){a.preventDefault();var e=c("#equella_preview_dialog");if(!e.length){e=c("<div/>"),e.attr("id","equella_preview_dialog").hide(),e.html("<h2/><iframe style='background: url(/images/ajax-loader-medium-444.gif) no-repeat left top; width: 800px; height: 350px; border: 0;' src='about:blank' borderstyle='0'/><div style='text-align: right;'><a href='#' class='original_link external external_link' target='_blank'>"+d(b.t("links.view_equella_content_in_new_window","view the content in a new window"))+"</a>"),e.find("h2").text(c(this).attr("title")||c(this).text()||b.t("titles.equella_content_preview","Equella Content Preview"));var f=e.find("iframe");setTimeout(function(){f.css("background","#fff")},2500),c("body").append(e),e.dialog({autoOpen:!1,width:"auto",resizable:!1,title:b.t("titles.equella_content_preview","Equella Content Preview"),close:function(){e.find("iframe").attr("src","about:blank")}})}e.find(".original_link").attr("href",c(this).attr("href")),e.dialog("close").dialog("open"),e.find("iframe").attr("src",c(this).attr("href"))}),c(".dialog_opener[aria-controls]:not(.user_content *)").live("click",function(a){var b=this;c("#"+c(this).attr("aria-controls")).ifExists(function(d){a.preventDefault(),d.data("dialog")||d.dialog(c.extend({autoOpen:!1,modal:!0},c(b).data("dialogOpts"))),d.dialog("open")})}),c.filePreviewsEnabled()?c("a.scribd_file_preview_link").live("click",function(a){a.preventDefault();var e=c(this).loadingImage({image_size:"small"}).hide();c.ajaxJSON(e.attr("href").replace(/\/download.*/,""),"GET",{},function(a){var f=a&&a.attachment,g=f&&f.scribd_doc&&f.scribd_doc.attributes;e.loadingImage("remove");if(f&&(g||c.isPreviewable(f.content_type,"google"))){var h=c("<span><br /></span>").insertAfter(e.parents(".link_holder:last")).loadDocPreview({scribd_doc_id:g&&g.doc_id,scribd_access_key:g&&g.access_key,mimeType:f.content_type,public_url:f.authenticated_s3_url}).append(c('<a href="#" style="font-size: 0.8em;" class="hide_file_preview_link">'+d(b.t("links.minimize_file_preview","Minimize File Preview"))+"</a>").click(function(a){a.preventDefault(),e.show(),h.remove(),c.trackEvent("hide_embedded_content","hide_file_preview")}));c.trackEvent("show_embedded_content","show_file_preview")}},function(){e.loadingImage("remove").hide()})}):c("a.scribd_file_preview_link").live("click",function(a){a.preventDefault(),alert(b.t("alerts.file_previews_disabled","File previews have been disabled for this Canvas site"))}),c(document).bind("user_content_change",p),setInterval(p,15e3),setTimeout(p,1e3),c(".zone_cached_datetime").each(function(){if(c(this).attr("title")){var a=c.parseFromISO(c(this).attr("title"));a.timestamp&&c(this).text(a.datetime_formatted)}}),c(".show_sub_messages_link").click(function(a){a.preventDefault(),c(this).parents(".subcontent").find(".communication_sub_message.toggled_communication_sub_message").removeClass("toggled_communication_sub_message"),c(this).parents(".communication_sub_message").remove()}),c(".communication_message .message_short .read_more_link").click(function(a){a.preventDefault(),c(this).parents(".communication_message").find(".message_short").hide().end().find(".message").show()}),c(".communication_message .close_notification_link").live("click",function(a){a.preventDefault();var b=c(this).parents(".communication_message");b.confirmDelete({url:c(this).attr("rel"),noMessage:!0,success:function(){c(this).slideUp(function(){c(this).remove()})}})}),c(".communication_message .add_entry_link").click(function(a){a.preventDefault();var b=c(this).parents(".communication_message"),d=b.find(".reply_message").hide(),e=b.find(".communication_sub_message.blank").clone(!0).removeClass("blank");d.before(e.show());var f=c.uniqueId("textarea_");e.find("textarea.rich_text").attr("id",f),c(document).triggerHandler("richTextStart",c("#"+f)),e.find("textarea:first").focus().select()}),c(document).bind("richTextStart",function(a,b){if(!b||b.length===0)return;b=c(b);if(!b||b.length===0)return;b.editorBox(),b.editorBox("focus",!0),e&&(e.attachToEditor(b),c("#sidebar_content").hide(),e.show())}).bind("richTextEnd",function(a,b){if(!b||b.length===0)return;b=c(b);if(!b||b.length===0)return;b.editorBox("destroy"),e&&(c("#sidebar_content").show(),e.hide())}),c(".cant_record_link").click(function(a){a.preventDefault(),c("#cant_record_dialog").dialog("close").dialog({autoOpen:!1,modal:!0,title:b.t("titles.cant_create_recordings","Can't Create Recordings?"),width:400}).dialog("open")}),c(".communication_message .content .links .show_users_link,.communication_message .header .show_users_link").click(function(a){a.preventDefault(),c(this).parents(".communication_message").find(".content .users_list").slideToggle()}),c(".communication_message .delete_message_link").click(function(a){a.preventDefault(),c(this).parents(".communication_message").confirmDelete({noMessage:!0,url:c(this).attr("href"),success:function(){c(this).slideUp()}})}),c(".communication_sub_message .add_conversation_message_form").formSubmit({beforeSubmit:function(a){c(this).find("button").attr("disabled",!0),c(this).find(".submit_button").text(b.t("status.posting_message","Posting Message...")),c(this).loadingImage()},success:function(a){c(this).loadingImage("remove");var b=c(this).parents(".communication_sub_message"),d=b.parents(".communication_message");message_data=a.messages[0],b.fillTemplateData({data:{post_date:c.parseFromISO(message_data.created_at).datetime_formatted,message:message_data.body},htmlValues:["message"]}),b.find(".message").show(),c(this).remove(),d.find(".reply_message").show(),c.flashMessage("Message Sent!"),c(document).triggerHandler("user_content_change"),location.href.match(/dashboard/)&&c.trackEvent("dashboard_comment","create")},error:function(a){c(this).loadingImage("remove"),c(this).find("button").attr("disabled",!1),c(this).find(".submit_button").text("Post Failed, Try Again"),c(this).formErrors(a)}}),c(".communication_sub_message .add_sub_message_form").formSubmit({beforeSubmit:function(a){c(this).find("button").attr("disabled",!0),c(this).find(".submit_button").text(b.t("status.posting_message","Posting Message...")),c(this).loadingImage()},success:function(a){c(this).loadingImage("remove");var b=c(this).parents(".communication_sub_message");if(c(this).hasClass("submission_comment_form")){var d=c(this).getTemplateData({textValues:["submission_user_id"]}).submission_user_id,e=null;for(var f in a){var g=a[f].submission;g.user_id==d&&(e=g)}if(e){var h=e.submission_comments[e.submission_comments.length-1].submission_comment;h.post_date=c.parseFromISO(h.created_at).datetime_formatted,h.message=h.formatted_body||h.comment,b.fillTemplateData({data:h,htmlValues:["message"]})}}else{var i=a.discussion_entry;i.post_date=c.parseFromISO(i.created_at).datetime_formatted,b.find(".content > .message_html").val(i.message),b.fillTemplateData({data:i,htmlValues:["message"]})}b.find(".message").show(),b.find(".user_content").removeClass("enhanced"),b.parents(".communication_message").find(".reply_message").removeClass("lonely_behavior_message").show(),c(document).triggerHandler("richTextEnd",c(this).find("textarea.rich_text")),c(document).triggerHandler("user_content_change"),c(this).remove(),location.href.match(/dashboard/)&&c.trackEvent("dashboard_comment","create")},error:function(a){c(this).loadingImage("remove"),c(this).find("button").attr("disabled",!1),c(this).find(".submit_button").text(b.t("errors.posting_message_failed","Post Failed, Try Again")),c(this).formErrors(a)}}),c(".communication_sub_message form .cancel_button").click(function(){var a=c(this).parents(".communication_sub_message"),b=c(this).parents(".communication_message");c(document).triggerHandler("richTextEnd",a.find("textarea.rich_text")),a.remove(),b.find(".reply_message").show()}),c(".communication_message,.communication_sub_message").bind("focusin mouseenter",function(){c(this).addClass("communication_message_hover")}).bind("focusout mouseleave",function(){c(this).removeClass("communication_message_hover")}),c(".communication_sub_message .more_options_reply_link").click(function(a){a.preventDefault();var b=c(this).parents("form"),d=null;b.hasClass("submission_comment_form")?d={comment:b.find("textarea:visible:first").val()||""}:d={message:b.find("textarea:visible:first").val()||""},location.href=c(this).attr("href")+"?message="+encodeURIComponent(d.message)}),c(".communication_message.new_activity_message").ifExists(function(){this.find(".message_type img").click(function(){var a=c(this),b=c.trim(a.attr("class"));a.parents(".message_type").find("img").removeClass("selected"),a.addClass("selected").parents(".new_activity_message").find(".message_type_text").text(a.attr("title")).end().find(".activity_form").hide().end().find("textarea, :text").val("").end().find("."+b+"_form").show().find(".context_select").change()}),this.find(".context_select").change(function(){var a=c(this),b=a.val(),d=a.parents(".communication_message"),e=d.find("form");e.attr("action",d.find("."+b+"_form_url").attr("href")),e.data("context_name",this.options[this.selectedIndex].text),e.data("context_code",b),d.find(".roster_list").hide().find(":checkbox").each(function(){c(this).attr("checked",!1)}),d.find("."+b+"_roster_list").show()}).triggerHandler("change"),this.find(".cancel_button").click(function(a){c(this).parents(".communication_message").hide().prev(".new_activity_message").show()}),this.find(".new_activity_message_link").click(function(a){a.preventDefault(),c(this).parents(".communication_message").hide().next(".new_activity_message").find(".message_type img.selected").click().end().show().find(":text:visible:first").focus().select()}),this.find("form.message_form").formSubmit({beforeSubmit:function(a){c("button").attr("disabled",!0),c("button.submit_button").text(b.t("status.posting_message","Posting Message..."))},success:function(a){c("button").attr("disabled",!1),c("button.submit_button").text("Post Message");var b=c(this).data("context_code")||"",d=c(this).data("context_name")||"";if(c(this).hasClass("discussion_topic_form")){var e=a.discussion_topic;e.context_code=d,e.user_name=c("#identity .user_name").text(),e.post_date=c.parseFromISO(e.created_at).datetime_formatted,e.topic_id=e.id;var f=c(this).parents(".communication_message").find(".template"),g=f.find(".communication_message").clone(!0);g.find(".header .title,.behavior_content .less_important a").attr("href",f.find("."+b+"_topic_url").attr("href")),g.find(".add_entry_link").attr("href",f.find("."+b+"_topics_url").attr("href")),g.find(".user_name").attr("href",f.find("."+b+"_user_url").attr("href")),g.find(".topic_assignment_link,.topic_assignment_url").attr("href",f.find("."+b+"_assignment_url").attr("href")),g.find(".attachment_name,.topic_attachment_url").attr("href",f.find("."+b+"_attachment_url").attr("href"));var h={discussion_topic_id:e.id};g.fillTemplateData({data:e,hrefValues:["topic_id","user_id","assignment_id","attachment_id"],avoid:".subcontent"}),g.find(".subcontent").fillTemplateData({data:h,hrefValues:["topic_id","user_id"]}),g.find(".subcontent form").attr("action",f.find("."+b+"_entries_url").attr("href")),g.fillFormData(h,{object_name:"discussion_entry"}),c(this).parents(".communication_message").after(g.hide()),g.slideDown(),c(this).parents(".communication_message").slideUp(),c(this).parents(".communication_message").prev(".new_activity_message").slideDown()}else c(this).hasClass("announcement_form")||location.reload()},error:function(a){c("button").attr("disabled",!1),c("button.submit_button").text(b.t("errors.posting_message_failed","Post Failed, Try Again")),c(this).formErrors(a)}})}),c("#topic_list .show_all_messages_link").show().click(function(a){a.preventDefault(),c("#topic_list .topic_message").show(),c(this).hide()});var q=parseInt(c("#time_zone_offset").text(),10),r=[];setTimeout(s,100);var u=c("#sequence_footer .sequence_details_url").filter(":last").attr("href");u&&c.ajaxJSON(u,"GET",{},function(a){var d=c("#sequence_footer");a.current_item&&(c("#sequence_details .current").fillTemplateData({data:a.current_item.content_tag}),c.each({previous:".prev",next:".next"},function(e,f){var g=d.find(f);if(a[e+"_item"]||a[e+"_module"]){var h=a[e+"_item"]&&a[e+"_item"].content_tag||a[e+"_module"]&&a[e+"_module"].context_module;a[e+"_item"]||(h.title=h.title||h.name,h.text=e=="previous"?b.t("buttons.previous_module","Previous Module"):b.t("buttons.next_module","Next Module"),g.addClass("module_button")),g.fillTemplateData({data:h}),a[e+"_item"]?g.attr("href",c.replaceTags(d.find(".module_item_url").attr("href"),"id",h.id)):g.attr("href",c.replaceTags(d.find(".module_url").attr("href"),"id",h.id)+"/items/"+(e==="previous"?"last":"first"))}else g.hide()}),d.show(),c(window).resize())}),c(".module_legend_link").click(function(a){var b=c(this).parents(".module_legend");b.hide(),b.next(".module_legend").show()});var v=c("#wizard_box"),x=window.location.pathname;c(".close_wizard_link").click(function(a){a.preventDefault(),c.store.userSet("hide_wizard_"+x,!0),v.slideUp("fast",function(){c(".wizard_popup_link").slideDown("fast"),w("hide")})}),c(".wizard_popup_link").click(function(a){a.preventDefault(),c(".wizard_popup_link").slideUp("fast"),v.slideDown("fast",function(){v.triggerHandler("wizard_opened"),c([document,window]).triggerHandler("scroll")})}),v.ifExists(function(a){a.bind("wizard_opened",function(){var b=a.find(".wizard_options"),c=b.height();b.height(c),a.find(".wizard_details").css({maxHeight:c-5,overflow:"auto"}),w("show")}),a.find(".wizard_options_list .option").click(function(b){var d=c(this),e=c(b.target).closest("a");if(e.length>0&&e.attr("href")!="#")return;b.preventDefault(),d.parents(".wizard_options_list").find(".option.selected").removeClass("selected"),d.addClass("selected");var f=a.find(".wizard_details"),g=d.getTemplateData({textValues:["header"]});g.link=g.header,f.fillTemplateData({data:g}),f.find(".details").remove(),f.find(".header").after(d.find(".details").clone(!0).show());var h=d.find(".header").attr("href");h!="#"?f.find(".link").show().attr("href",h):f.find(".link").hide(),f.hide().fadeIn("fast")}),setTimeout(function(){c.store.userGet("hide_wizard_"+x)||c(".wizard_popup_link.auto_open:first").click()},500)}),c(".more_link").click(function(a){return c(this).closest("li").slideUp().parents("ul").children(":hidden").slideDown().first().find(":tabbable:first").focus(),!1}),c(".to-do-list, #topic_list").delegate(".disable_item_link","click",function(a){function g(a){e.confirmDelete({url:a,noMessage:!0,success:function(){c(this).slideUp(function(){c(this).remove()})}})}a.preventDefault();var e=c(this).parents("li, div.topic_message"),f=c(this).attr("href");c(this).hasClass("grading")?(options={},options['<span class="ui-icon ui-icon-trash">&nbsp;</span> '+d(b.t("ignore_forever","Ignore Forever"))]=function(){g(f+"?permanent=1")},options['<span class="ui-icon ui-icon-star">&nbsp;</span> '+d(b.t("ignore_until_new_submission","Ignore Until New Submission"))]=function(){g(f)},c(this).dropdownList({options:options})):g(f+"?permanent=1")}),c("h1").length||c('<h1 class="ui-helper-hidden-accessible" />').text(document.title).prependTo("#content");if(!c("h2").length&&c("#breadcrumbs li:last").text().length){var y=c('<h2 class="ui-helper-hidden-accessible" />').text(c("#breadcrumbs li:last").text()),z=c("#content h1");z.length?z.after(y):y.prependTo("#content")}setTimeout(function(){c("#content a:external,#content a.explicit_external_link").each(function(){c(this).not(":has(img)").not(".not_external").addClass("external").children("span.ui-icon-extlink").remove().end().html("<span>"+c(this).html()+"</span>").attr("target","_blank").append('<span class="ui-icon ui-icon-extlink ui-icon-inline" title="'+d(b.t("titles.external_link","Links to an external site."))+'"/>')})},2e3)})})
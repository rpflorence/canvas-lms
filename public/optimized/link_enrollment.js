require(["i18n","jquery","jquery.ajaxJSON","jquery.instructure_forms","jquery.instructure_jquery_patches","jquery.instructure_misc_plugins","jquery.templateData"],function(a,b){a=a.scoped("link_enrollment"),window.link_enrollment=function(){return{choose:function(c,d,e,f){var g=b(this).parents(".user"),h=b("#link_student_dialog"),i={};i.short_name=c,h.fillTemplateData({data:i});if(!h.data("loaded")){h.find(".loading_message").text(a.t("messages.loading_students","Loading Students..."));var j=h.find(".student_url").attr("href");b.ajaxJSON(j,"GET",{},function(c){for(var g in c){var j=c[g],k=b("<option/>");j.id&&j.name&&(k.val(j.id).text(j.name),h.find(".student_options").append(k))}var k=b("<option/>");k.val("none").text(a.t("options.no_link","[ No Link ]")),h.data("loaded",!0),h.find(".student_options").append(k),h.find(".enrollment_id").val(d),h.find(".student_options").val("none").val(e),h.find(".loading_message").hide().end().find(".students_link").show(),h.find(".existing_user").showIf(e),h.data("callback",f),i.existing_user_name=h.find(".student_options option[value='"+e+"']").text(),h.fillTemplateData({data:i})},function(){h.find(".loading_message").text(a.t("errors.load_failed","Loading Students Failed, please try again")),h.data("callback",f)})}else h.find(".enrollment_id").val(d),h.find(".existing_user").showIf(e),h.find(".student_options").val("none").val(e),i.existing_user_name=h.find(".student_options option[value='"+e+"']").text(),h.fillTemplateData({data:i});h.find(".existing_user").showIf(e),h.find(".student_options option:not(.blank)").remove(),h.dialog("close").dialog({autoOpen:!1,title:a.t("titles.link_to_student","Link to Student"),width:400}).dialog("open")}}}(),b(document).ready(function(){b(document).bind("enrollment_added",function(){b("#link_student_dialog").data("loaded",!1)}),b("#link_student_dialog .cancel_button").click(function(){b("#link_student_dialog").dialog("close")}),b("#link_student_dialog_form").formSubmit({beforeSubmit:function(c){b(this).find("button").attr("disabled",!0).end().find(".save_button").text(a.t("messages.linking_to_student","Linking to Student..."))},success:function(c){b(this).find("button").attr("disabled",!1).end().find(".save_button").text(a.t("buttons.link","Link to Student"));var d=c.enrollment,e=b("#link_student_dialog").data("callback");b("#link_student_dialog").dialog("close"),b.isFunction(e)&&d&&e(d)},error:function(c){b(this).find("button").attr("disabled",!1).find(".save_button").text(a.t("errors.link_failed","Linking Failed, please try again"))}})})})